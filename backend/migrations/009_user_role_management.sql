-- =============================================================================
-- PRISM Writer - ì‚¬ìš©ì ê¶Œí•œ ì—…ê·¸ë ˆì´ë“œ/ë‹¤ìš´ê·¸ë ˆì´ë“œ í…œí”Œë¦¿
-- =============================================================================
-- íŒŒì¼: 009_user_role_management.sql
-- ì—­í• : ì‚¬ìš©ì ë“±ê¸‰ ë³€ê²½ (pending â†’ free â†’ premium â†’ special â†’ admin)
-- ì‹¤í–‰: Supabase SQL Editorì—ì„œ í•„ìš”í•œ ë¶€ë¶„ë§Œ ì„ íƒí•˜ì—¬ ì‹¤í–‰
-- =============================================================================

-- =============================================================================
-- ğŸ“‹ ì‚¬ìš© ë°©ë²•
-- =============================================================================
-- 1. ì•„ë˜ì—ì„œ ì›í•˜ëŠ” ì‘ì—…ì˜ SQLì„ ë³µì‚¬í•©ë‹ˆë‹¤
-- 2. ì´ë©”ì¼ ì£¼ì†Œë¥¼ ë³€ê²½í•  ì‚¬ìš©ìì˜ ì´ë©”ì¼ë¡œ ìˆ˜ì •í•©ë‹ˆë‹¤
-- 3. Supabase SQL Editorì—ì„œ ì‹¤í–‰í•©ë‹ˆë‹¤
-- =============================================================================

-- =============================================================================
-- ğŸ”¼ ì—…ê·¸ë ˆì´ë“œ ì˜ˆì‹œ
-- =============================================================================

-- -----------------------------------------------------------------------------
-- ì˜ˆì‹œ 1: pending â†’ free (ëŒ€ê¸° â†’ ë¬´ë£ŒíšŒì› ìŠ¹ì¸)
-- -----------------------------------------------------------------------------
-- âš ï¸ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ìˆ˜ì •í•˜ì„¸ìš”!
UPDATE profiles
SET 
    role = 'free',
    tier = 1,
    is_approved = true,
    approved_at = NOW(),
    daily_request_limit = 5,        -- ì¼ì¼ 5íšŒ
    monthly_token_limit = 10000,    -- ì›”ê°„ 10,000 í† í°
    updated_at = NOW()
WHERE id = (
    SELECT id FROM auth.users 
    WHERE email = 'example@gmail.com'  -- âš ï¸ ë³€ê²½í•  ì‚¬ìš©ì ì´ë©”ì¼
);

-- -----------------------------------------------------------------------------
-- ì˜ˆì‹œ 2: free â†’ premium (ë¬´ë£Œ â†’ í”„ë¦¬ë¯¸ì—„)
-- -----------------------------------------------------------------------------
-- âš ï¸ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ìˆ˜ì •í•˜ì„¸ìš”!
UPDATE profiles
SET 
    role = 'premium',
    tier = 2,
    is_approved = true,
    daily_request_limit = 50,       -- ì¼ì¼ 50íšŒ
    monthly_token_limit = 30000,    -- ì›”ê°„ 30,000 í† í°
    updated_at = NOW()
WHERE id = (
    SELECT id FROM auth.users 
    WHERE email = 'example@gmail.com'  -- âš ï¸ ë³€ê²½í•  ì‚¬ìš©ì ì´ë©”ì¼
);

-- -----------------------------------------------------------------------------
-- ì˜ˆì‹œ 3: premium â†’ special (í”„ë¦¬ë¯¸ì—„ â†’ ìŠ¤í˜ì…œ)
-- -----------------------------------------------------------------------------
-- âš ï¸ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ìˆ˜ì •í•˜ì„¸ìš”!
UPDATE profiles
SET 
    role = 'special',
    tier = 3,
    is_approved = true,
    daily_request_limit = 999999,   -- ë¬´ì œí•œ
    monthly_token_limit = 200000,   -- ì›”ê°„ 200,000 í† í°
    updated_at = NOW()
WHERE id = (
    SELECT id FROM auth.users 
    WHERE email = 'example@gmail.com'  -- âš ï¸ ë³€ê²½í•  ì‚¬ìš©ì ì´ë©”ì¼
);

-- -----------------------------------------------------------------------------
-- ì˜ˆì‹œ 4: â†’ admin (ê´€ë¦¬ì ìŠ¹ê²©)
-- -----------------------------------------------------------------------------
-- âš ï¸ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ìˆ˜ì •í•˜ì„¸ìš”!
UPDATE profiles
SET 
    role = 'admin',
    tier = 4,
    is_approved = true,
    daily_request_limit = 999999,   -- ë¬´ì œí•œ
    monthly_token_limit = 999999,   -- ë¬´ì œí•œ
    updated_at = NOW()
WHERE id = (
    SELECT id FROM auth.users 
    WHERE email = 'example@gmail.com'  -- âš ï¸ ë³€ê²½í•  ì‚¬ìš©ì ì´ë©”ì¼
);

-- =============================================================================
-- ğŸ”½ ë‹¤ìš´ê·¸ë ˆì´ë“œ ì˜ˆì‹œ
-- =============================================================================

-- -----------------------------------------------------------------------------
-- ì˜ˆì‹œ 5: premium â†’ free (í”„ë¦¬ë¯¸ì—„ â†’ ë¬´ë£Œ)
-- -----------------------------------------------------------------------------
-- âš ï¸ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ìˆ˜ì •í•˜ì„¸ìš”!
UPDATE profiles
SET 
    role = 'free',
    tier = 1,
    daily_request_limit = 5,
    monthly_token_limit = 10000,
    updated_at = NOW()
WHERE id = (
    SELECT id FROM auth.users 
    WHERE email = 'example@gmail.com'  -- âš ï¸ ë³€ê²½í•  ì‚¬ìš©ì ì´ë©”ì¼
);

-- -----------------------------------------------------------------------------
-- ì˜ˆì‹œ 6: â†’ pending (ì„œë¹„ìŠ¤ ì •ì§€/ìŠ¹ì¸ ì·¨ì†Œ)
-- -----------------------------------------------------------------------------
-- âš ï¸ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ìˆ˜ì •í•˜ì„¸ìš”!
UPDATE profiles
SET 
    role = 'pending',
    tier = 0,
    is_approved = false,
    daily_request_limit = 0,
    monthly_token_limit = 0,
    updated_at = NOW()
WHERE id = (
    SELECT id FROM auth.users 
    WHERE email = 'example@gmail.com'  -- âš ï¸ ë³€ê²½í•  ì‚¬ìš©ì ì´ë©”ì¼
);

-- =============================================================================
-- ğŸ“Š ë³€ê²½ ê²°ê³¼ í™•ì¸
-- =============================================================================

-- íŠ¹ì • ì‚¬ìš©ì í™•ì¸
SELECT 
    p.id,
    u.email,
    p.role,
    p.tier,
    p.is_approved,
    p.daily_request_limit,
    p.monthly_token_limit,
    p.updated_at
FROM profiles p
JOIN auth.users u ON p.id = u.id
WHERE u.email = 'example@gmail.com';  -- âš ï¸ í™•ì¸í•  ì‚¬ìš©ì ì´ë©”ì¼

-- ì „ì²´ ì‚¬ìš©ì ëª©ë¡
SELECT 
    p.id,
    u.email,
    p.role,
    p.tier,
    p.is_approved,
    p.daily_request_limit,
    p.monthly_token_limit
FROM profiles p
JOIN auth.users u ON p.id = u.id
ORDER BY p.tier DESC, p.created_at DESC;

-- =============================================================================
-- ğŸ“‹ ë“±ê¸‰ë³„ í• ë‹¹ëŸ‰ ì°¸ê³ 
-- =============================================================================
-- | ë“±ê¸‰     | role    | tier | ì¼ì¼ ìš”ì²­ | ì›”ê°„ í† í°   |
-- |----------|---------|------|----------|------------|
-- | ëŒ€ê¸°     | pending | 0    | 0        | 0          |
-- | ë¬´ë£Œ     | free    | 1    | 5        | 10,000     |
-- | í”„ë¦¬ë¯¸ì—„ | premium | 2    | 50       | 30,000     |
-- | ìŠ¤í˜ì…œ   | special | 3    | ë¬´ì œí•œ    | 200,000    |
-- | ê´€ë¦¬ì   | admin   | 4    | ë¬´ì œí•œ    | ë¬´ì œí•œ      |
-- =============================================================================
