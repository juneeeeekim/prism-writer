-- =============================================================================
-- Phase 12: Category Column Migration
-- =============================================================================
-- 파일: supabase/migrations/034_add_category.sql
-- 역할: user_documents 테이블에 category 컬럼 추가
-- 생성일: 2025-12-28
-- =============================================================================

-- -----------------------------------------------------------------------------
-- 1. category 컬럼 추가
-- -----------------------------------------------------------------------------
ALTER TABLE public.user_documents 
ADD COLUMN IF NOT EXISTS category TEXT NOT NULL DEFAULT '미분류';

-- -----------------------------------------------------------------------------
-- 2. 성능 인덱스 추가
-- -----------------------------------------------------------------------------
CREATE INDEX IF NOT EXISTS idx_user_documents_category 
ON public.user_documents(category);

-- -----------------------------------------------------------------------------
-- 3. 기존 데이터 처리 (혹시 NULL이 있을 경우 대비)
-- -----------------------------------------------------------------------------
UPDATE public.user_documents 
SET category = '미분류' 
WHERE category IS NULL OR category = '';
