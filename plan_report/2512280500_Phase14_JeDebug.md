# 🦅 JeDebug Analysis Report: Phase 14 Checklist

**분석 일시**: 2025-12-28
**분석 대상**: [Phase 14 Checklist](file:///c:/Users/chyon/Desktop/01.Project/00.Program/prismLM/plan_report/251228_Phase14_Feedback_Memory_Checklist.md)
**Role**: Senior Lead Developer & JeDebug

---

## 1. L (Logic & Feasibility) ⭐

**Status**: ⚠️ **Logic Gaps Found**

- **[Critical] System Prompt Update Missing**:

  - **문제**: 선호 지식(Preference)을 검색해서 Context에 넣더라도, LLM이 **"이것을 최우선으로 반영하라"**는 지침이 없으면 무시될 수 있습니다. 단순 RAG가 아니라 "사용자 선호도"임을 명시해야 합니다.
  - **영향**: 기능이 동작해도 "말투나 답변 스타일"이 변하지 않음.

- **[Major] Vector Search Implementation**:
  - **문제**: Supabase JS Client는 테이블 직접 조회 시 벡터 유사도 검색(`textSearch` 등)을 지원하지 않습니다. `rpc` 함수(`match_user_preferences`)가 필수적입니다.
  - **체크리스트 상태**: "RPC 필요 시 추가"라고 모호하게 되어 있음. **필수**로 변경해야 함.

## 2. I (Implementation Detail)

**Status**: ⚠️ **Needs Specificity**

- **Embedding Dimension**:
  - `lib/rag/embedding.ts` 확인 결과 `dimensions: 1536`입니다. 마이그레이션 파일 작성 시 `vector(1536)`으로 명시해야 합니다.
- **Async Handling**:
  - 피드백 API(`route.ts`)에서 `await`를 할지 `fire-and-forget`을 할지 명시해야 합니다. Vercel 환경이므로 `waitUntil`을 쓰거나, 중요 데이터를 위해 `await`를 권장합니다.

## 3. V (Verification Plan)

**Status**: ✅ **Acceptable**

- 테스트 시나리오는 적절하나, **"Prompt Injection Verification"** 항목(프롬프트에 실제 주입되었는지 로그 확인)이 추가되면 더 좋습니다.

## 4. E (Environment & Risk)

**Status**: ✅ **Low Risk**

- 기존 데이터에 영향을 주지 않는 신규 테이블 작업이므로 회귀 리스크는 낮습니다.

---

# 📝 Checklist Modification Proposal (수정안)

## ✅ Output Mode: Checklist-Only

## 1) 🔧 로직 및 구현 보완 (Logic Fixes)

- [ ] (Critical) System Prompt 업데이트 항목 추가
  - [ ] 원인: LLM이 선호 지식을 일반 문맥과 구분하지 못함
  - [ ] **수정 제안**: P14-04 다음에 `P14-05: System Prompt Update` 추가 (Target: `lib/rag/prompts/system.ts` 또는 유사 파일)
- [ ] (Major) RPC 함수 필수화
  - [ ] 원인: Supabase Client SDK 한계
  - [ ] **수정 제안**: P14-01 마이그레이션 항목에 `match_user_preferences` RPC 함수 생성 포함 명시

## 2) 🚨 리스크 및 안전장치 (Risk Guardrails)

- [ ] (Mid) 임베딩 차원 명시
  - [ ] 위험 요소: 차원 불일치 시 Insert 에러
  - [ ] **방어 로직 제안**: P14-01 상세 내용에 `vector(1536)` 명시
- [ ] (Mid) 피드백 저장 대기 처리
  - [ ] 위험 요소: Vercel 함수 종료로 인한 저장 유실
  - [ ] **방어 로직 제안**: P14-03 상세 내용에 `Promise.all`로 피드백 저장과 메모리 저장을 병렬 `await` 처리 명시

## 3) 🧪 검증 기준 구체화 (Test Criteria)

- [ ] Happy Path: 질문 -> 좋아요 -> "기억했습니다" 로그 확인 -> 재질문 -> 반영된 답변 확인
- [ ] Debugging: `prompt` 로그를 확인하여 `User Preferences` 섹션이 주입되었는지 검증

## 4) 최종 판단 (Decision)

- [ ] 상태 선택: ⚠️ 체크리스트 수정 후 진행
- [ ] 결함 요약: **System Prompt 수정 누락으로 인해 기능 효과가 미비할 수 있음.**
