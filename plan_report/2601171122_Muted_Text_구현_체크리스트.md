# [Shadow Writer] Muted Text ê¸°ëŠ¥ êµ¬í˜„ ì²´í¬ë¦¬ìŠ¤íŠ¸

> **ì„¤ê³„ ë¬¸ì„œ**: `2601171120_Shadow_Writer_Styling_Upgrade_Plan.md` > **ì‘ì„± ì¼ì**: 2026-01-17

---

## [Phase 0: í™˜ê²½ ì¤€ë¹„ (Setup)]

**Before Start:**

- âš ï¸ ì£¼ì˜: `ShadowWriter.tsx` ë° `ShadowWriterEditor.tsx` ìˆ˜ì • ì „ ë°˜ë“œì‹œ Git ì»¤ë°‹ ì™„ë£Œ
- âš ï¸ ì£¼ì˜: ê¸°ì¡´ `Ghost Text Overlay` ê¸°ëŠ¥ì€ Phase 3ê¹Œì§€ **ê±´ë“œë¦¬ì§€ ë§ ê²ƒ**

**Implementation Items:**

- [x] **P0-01**: TipTap í•„ìˆ˜ ì˜ì¡´ì„± ì„¤ì¹˜ âœ… (2026-01-17 ì™„ë£Œ)
  - `Target`: `frontend/package.json`
  - `Logic (Pseudo)`:
    ```bash
    npm install @tiptap/react @tiptap/starter-kit @tiptap/extension-text-style
    npm install @tiptap/extension-bubble-menu @tiptap/extension-placeholder
    ```
  - `Safety`: ì„¤ì¹˜ í›„ `npm run build` ì‹¤í–‰í•˜ì—¬ ê¸°ì¡´ ë¹Œë“œì— ì¶©ëŒ ì—†ëŠ”ì§€ í™•ì¸
  - **ì„¤ì¹˜ëœ ë²„ì „**: @tiptap/\* ^3.15.3 (68ê°œ íŒ¨í‚¤ì§€ ì¶”ê°€)

**Definition of Done (ê²€ì¦):**

- [x] `node_modules/@tiptap/react` í´ë” ì¡´ì¬ í™•ì¸ âœ…
- [x] `npm run build` ì„±ê³µ (exit code 0) âœ…

---

## [Phase 1: MutedMark Extension ê°œë°œ]

**Before Start:**

- âš ï¸ ì£¼ì˜: TipTap Extension ì‘ì„± ì‹œ `configure()` ì˜µì…˜ ëˆ„ë½í•˜ë©´ ëŸ°íƒ€ì„ ì—ëŸ¬ ë°œìƒ

**Implementation Items:**

- [x] **P1-01**: `MutedMark` Extension ëª¨ë“ˆ ìƒì„± âœ… (2026-01-17 ì™„ë£Œ)
  - `Target`: `frontend/src/components/Editor/extensions/MutedMark.ts` (NEW)
  - `Logic (Pseudo)`:

    ```typescript
    import { Mark, markInputRule } from "@tiptap/core";

    export const MutedMark = Mark.create({
      name: "muted",

      // HTML ë Œë”ë§: <span class="muted-text">...</span>
      parseHTML() {
        return [{ tag: "span.muted-text" }];
      },
      renderHTML({ HTMLAttributes }) {
        return ["span", { ...HTMLAttributes, class: "muted-text" }, 0];
      },

      // ì»¤ë§¨ë“œ: editor.chain().focus().toggleMuted().run()
      addCommands() {
        return {
          toggleMuted:
            () =>
            ({ commands }) =>
              commands.toggleMark(this.name),
          setMuted:
            () =>
            ({ commands }) =>
              commands.setMark(this.name),
          unsetMuted:
            () =>
            ({ commands }) =>
              commands.unsetMark(this.name),
        };
      },
    });
    ```

  - `Key Variables`: `MutedMark`, `toggleMuted`, `muted-text`
  - `Safety`: `Mark.create` í˜¸ì¶œ ì‹œ `name` í•„ë“œ ëˆ„ë½í•˜ë©´ ì˜¤ë¥˜ â†’ í•„ìˆ˜ ì²´í¬
  - **êµ¬í˜„ ì™„ë£Œ**: TypeScript íƒ€ì… ì„ ì–¸ í¬í•¨, mergeAttributes ì‚¬ìš©

- [x] **P1-02**: CSS ìŠ¤íƒ€ì¼ ì •ì˜
  - `Target`: `frontend/src/app/globals.css`
  - `Logic (Pseudo)`:
    ```css
    /* [Muted Text] Phase 1 - ë¹„ê°•ì¡° í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
    .muted-text {
      color: #9ca3af; /* Gray-400 */
      font-style: italic;
      font-size: 0.9em;
      text-decoration: line-through;
      opacity: 0.7;
      transition: all 0.2s ease;
    }
    .muted-text:hover {
      color: #4b5563; /* Gray-600 */
      opacity: 1;
      text-decoration: none;
    }
    ```
  - `Safety`: ê¸°ì¡´ `.ghost-text-overlay` í´ë˜ìŠ¤ì™€ ì¶©ëŒí•˜ì§€ ì•Šë„ë¡ ë„¤ì´ë° í™•ì¸

**Definition of Done (ê²€ì¦):**

- [x] `npx tsc --noEmit` â†’ 0 errors (Extension íƒ€ì… ê²€ì¦) âœ…
- [x] `MutedMark.ts` íŒŒì¼ ë‹¨ë… import í…ŒìŠ¤íŠ¸ âœ… (ë¹Œë“œ ì„±ê³µìœ¼ë¡œ í™•ì¸)

---

## [Phase 2: RichShadowWriter ì»´í¬ë„ŒíŠ¸ êµ¬ì¶•]

**Before Start:**

- âš ï¸ ì£¼ì˜: ê¸°ì¡´ `ShadowWriter.tsx`ëŠ” **ì‚­ì œí•˜ì§€ ë§ ê²ƒ** (fallbackìš©ìœ¼ë¡œ ë³´ì¡´)
- âš ï¸ ì£¼ì˜: `useEditorState` í›…ê³¼ì˜ ì—°ë™ í•„ìˆ˜ (content, setContent)

**Implementation Items:**

- [x] **P2-01**: `RichShadowWriter` ì»´í¬ë„ŒíŠ¸ ìŠ¤ìºí´ë”© âœ… (2026-01-17 ì™„ë£Œ)
  - `Target`: `frontend/src/components/Editor/RichShadowWriter.tsx` (NEW)
  - `Logic (Pseudo)`:

    ```typescript
    import { useEditor, EditorContent } from "@tiptap/react";
    import StarterKit from "@tiptap/starter-kit";
    import Placeholder from "@tiptap/extension-placeholder";
    import { MutedMark } from "./extensions/MutedMark";

    interface RichShadowWriterProps {
      text: string; // ì´ˆê¸°ê°’ (HTML ë˜ëŠ” Plain Text)
      onChange: (html: string) => void;
      projectId?: string;
      enabled?: boolean;
      placeholder?: string;
      fontSize?: number;
    }

    export default function RichShadowWriter(props) {
      const editor = useEditor({
        extensions: [
          StarterKit,
          Placeholder.configure({ placeholder: props.placeholder }),
          MutedMark,
        ],
        content: props.text,
        onUpdate: ({ editor }) => {
          props.onChange(editor.getHTML());
        },
      });

      if (!editor) return null;

      return (
        <div className="rich-shadow-writer h-full">
          <EditorContent
            editor={editor}
            style={{ fontSize: `${props.fontSize}px` }}
          />
        </div>
      );
    }
    ```

  - `Key Variables`: `editor`, `EditorContent`, `onUpdate`
  - `Safety`: `useEditor`ëŠ” SSRì—ì„œ null ë°˜í™˜ ê°€ëŠ¥ â†’ `if (!editor) return null` í•„ìˆ˜

- [x] **P2-02**: Bubble Menu (í…ìŠ¤íŠ¸ ì„ íƒ ì‹œ Mute ë²„íŠ¼) ì¶”ê°€ âœ… (2026-01-17 ì™„ë£Œ)
  - `Target`: `RichShadowWriter.tsx` ë‚´ë¶€
  - `Logic (Pseudo)`:

    ```typescript
    import { BubbleMenuPlugin } from "@tiptap/extension-bubble-menu";

    // ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ - BubbleMenuPlugin ì‚¬ìš© (TipTap v3)
    const bubbleMenuRef = useRef<HTMLDivElement>(null);

    useEffect(() => {
      if (!editor || !bubbleMenuRef.current) return;
      const plugin = BubbleMenuPlugin({
        pluginKey: "bubbleMenu",
        editor,
        element: bubbleMenuRef.current,
      });
      editor.registerPlugin(plugin);
      return () => editor.unregisterPlugin("bubbleMenu");
    }, [editor]);
    ```

  - `Key Variables`: `BubbleMenuPlugin`, `editor.isActive('muted')`, `toggleMuted`
  - `Safety`: `editor`ê°€ nullì¼ ë•Œ `BubbleMenu` ë Œë”ë§ ë°©ì§€ (ì´ë¯¸ ìƒìœ„ì—ì„œ ì²˜ë¦¬ë¨)
  - **êµ¬í˜„ ì™„ë£Œ**: TipTap v3 í˜¸í™˜ BubbleMenuPlugin ë°©ì‹ìœ¼ë¡œ êµ¬í˜„

- [x] **P2-03**: Ghost Text (ê¸°ì¡´ ì œì•ˆ í‘œì‹œ) ê¸°ëŠ¥ í¬íŒ… âœ… (2026-01-17 ì™„ë£Œ)
  - `Target`: `RichShadowWriter.tsx` ë‚´ë¶€
  - `Logic (Pseudo)`:
    ```typescript
    // ê¸°ì¡´ ShadowWriter.tsxì˜ fetchSuggestion, GhostTextOverlay ë¡œì§ ì¬ì‚¬ìš©
    // TipTapì˜ ì—ë””í„° ì˜ì—­ í•˜ë‹¨ì— Overlay í˜•íƒœë¡œ í‘œì‹œ (ê¸°ì¡´ê³¼ ë™ì¼)
    // cursorPosition ëŒ€ì‹  editor.state.selection.anchor ì‚¬ìš©
    ```
  - `Safety`: API í˜¸ì¶œ (`/api/suggest`) ë¡œì§ì€ ê·¸ëŒ€ë¡œ ìœ ì§€, ì¸í„°í˜ì´ìŠ¤ë§Œ ë³€ê²½
  - **êµ¬í˜„ ì™„ë£Œ**: useDebounce, fetchSuggestion, GhostTextOverlay, Tab/Esc ë‹¨ì¶•í‚¤ í¬íŒ… ì™„ë£Œ

**Definition of Done (ê²€ì¦):**

- [x] `npx tsc --noEmit` â†’ 0 errors âœ…
- [x] `npm run build` ì„±ê³µ âœ…
- [x] ê°œë°œ ì„œë²„ ì‹œì‘ ì„±ê³µ âœ… (localhost:3000)
- [x] CSS ìŠ¤íƒ€ì¼ (.muted-text) ì •ì˜ ì™„ë£Œ âœ…
- [ ] ê°œë°œ ì„œë²„ì—ì„œ `RichShadowWriter` ì»´í¬ë„ŒíŠ¸ ë‹¨ë… ë Œë”ë§ ì„±ê³µ â†’ **Phase 3 ì™„ë£Œ í›„ ê²€ì¦**
- [ ] í…ìŠ¤íŠ¸ ì…ë ¥ â†’ `onChange` ì½œë°± í˜¸ì¶œ í™•ì¸ â†’ **Phase 3 ì™„ë£Œ í›„ ê²€ì¦**
- [ ] í…ìŠ¤íŠ¸ ì„ íƒ â†’ BubbleMenu í‘œì‹œ í™•ì¸ â†’ **Phase 3 ì™„ë£Œ í›„ ê²€ì¦**
- [ ] "ğŸ‘» ìˆ¨ê¸°ê¸°" ë²„íŠ¼ í´ë¦­ â†’ ì„ íƒ í…ìŠ¤íŠ¸ Gray/Italic ìŠ¤íƒ€ì¼ ì ìš© í™•ì¸ â†’ **Phase 3 ì™„ë£Œ í›„ ê²€ì¦**

---

## [Phase 3: ì—ë””í„° êµì²´ ë° í†µí•©]

**Before Start:**

- âš ï¸ ì£¼ì˜: `ShadowWriterEditor.tsx` ìˆ˜ì • ì‹œ `useAutosave`, `useEditorState` ì—°ë™ ìœ ì§€ í•„ìˆ˜
- âš ï¸ ì£¼ì˜: Feature Flagë¡œ ê¸°ì¡´/ì‹ ê·œ ì—ë””í„° ìŠ¤ìœ„ì¹­ ê°€ëŠ¥í•˜ê²Œ êµ¬í˜„ ê¶Œì¥

**Implementation Items:**

- [x] **P3-01**: Feature Flag ë“±ë¡ âœ… (ì´ë¯¸ êµ¬í˜„ë¨ - featureFlags.ts 448-459ì¤„)
  - `Target`: `frontend/src/config/featureFlags.ts`
  - `Logic (Pseudo)`:
    ```typescript
    // ê¸°ì¡´ ENABLE_SHADOW_WRITER ì™¸ì— ì¶”ê°€
    export const ENABLE_RICH_SHADOW_WRITER: boolean =
      process.env.NEXT_PUBLIC_ENABLE_RICH_SHADOW_WRITER === "true";
    ```
  - `Key Variables`: `ENABLE_RICH_SHADOW_WRITER`

- [x] **P3-02**: `ShadowWriterEditor`ì—ì„œ ì¡°ê±´ë¶€ ë Œë”ë§ âœ… (2026-01-17 ì™„ë£Œ)
  - `Target`: `frontend/src/components/Editor/ShadowWriterEditor.tsx`
  - `Logic (Pseudo)`:

    ```typescript
    import ShadowWriter from './ShadowWriter'
    import RichShadowWriter from './RichShadowWriter'
    import { FEATURE_FLAGS } from '@/config/featureFlags'

    // render() ë‚´ë¶€
    {FEATURE_FLAGS.ENABLE_RICH_SHADOW_WRITER ? (
      <RichShadowWriter
        text={content}
        onChange={handleContentChange}
        projectId={projectId ?? undefined}
        enabled={FEATURE_FLAGS.ENABLE_SHADOW_WRITER}
        triggerMode={triggerMode}
        fontSize={fontSize}
        placeholder="ê¸€ì„ ì‘ì„±í•˜ì„¸ìš”..."
      />
    ) : (
      <ShadowWriter ... />  // ê¸°ì¡´ ìœ ì§€
    )}
    ```

  - `Safety`: Feature Flagê°€ `false`ì´ë©´ ê¸°ì¡´ ë™ì‘ ë³´ì¥ (Rollback Path)

- [x] **P3-03**: ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ê³ ë ¤ (HTML â†” Plain Text) âœ… (2026-01-17 ì™„ë£Œ)
  - `Target`: `RichShadowWriter.tsx` ë° `useEditorState.ts`
  - `Logic (Pseudo)`:
    ```typescript
    // ê¸°ì¡´ content (plain text)ë¥¼ TipTapì— ë¡œë“œ ì‹œ:
    // - TipTapì€ ê¸°ë³¸ì ìœ¼ë¡œ Plain Textë„ ë Œë”ë§ ê°€ëŠ¥ (ìë™ <p> ë˜í•‘)
    // - í–¥í›„ ì €ì¥ ì‹œ HTMLë¡œ ì €ì¥í• ì§€ Plain Textë¡œ ì €ì¥í• ì§€ ì •ì±… ê²°ì • í•„ìš”
    // [í˜„ì¬ ê¶Œì¥]: HTMLë¡œ ì €ì¥í•˜ë˜, ë¶ˆëŸ¬ì˜¬ ë•Œ Plain Textë„ í˜¸í™˜ë˜ë„ë¡
    ```
  - `Safety`: ê¸°ì¡´ ì‚¬ìš©ì ë°ì´í„°(Plain Text)ê°€ ê¹¨ì§€ì§€ ì•Šë„ë¡ Backward Compatibility ìœ ì§€

**Definition of Done (ê²€ì¦):**

- [x] `.env.local`ì— `NEXT_PUBLIC_ENABLE_RICH_SHADOW_WRITER=true` ì¶”ê°€ âœ… (2026-01-17 ì™„ë£Œ)
- [ ] ê°œë°œ ì„œë²„ ì¬ì‹œì‘ í›„ `RichShadowWriter` í™œì„±í™” í™•ì¸ â†’ **ìˆ˜ë™ í…ŒìŠ¤íŠ¸ í•„ìš”** (ë¡œê·¸ì¸ í•„ìš”)
- [ ] ê¸°ì¡´ `Autosave` ê¸°ëŠ¥ ì •ìƒ ë™ì‘ í™•ì¸ â†’ **ìˆ˜ë™ í…ŒìŠ¤íŠ¸ í•„ìš”** (ë¡œê·¸ì¸ í•„ìš”)
- [ ] Ctrl+S ìˆ˜ë™ ì €ì¥ ì •ìƒ ë™ì‘ í™•ì¸ â†’ **ìˆ˜ë™ í…ŒìŠ¤íŠ¸ í•„ìš”** (ë¡œê·¸ì¸ í•„ìš”)
- [ ] Feature Flag `false`ë¡œ ë³€ê²½ ì‹œ ê¸°ì¡´ `ShadowWriter` ì •ìƒ ì‘ë™ í™•ì¸ â†’ **ìˆ˜ë™ í…ŒìŠ¤íŠ¸ í•„ìš”**

---

## [Phase 4: ìµœì¢… ì •ë¦¬ ë° ë°°í¬]

**Before Start:**

- âš ï¸ ì£¼ì˜: í”„ë¡œë•ì…˜ ë°°í¬ ì „ Feature Flag `false`ë¡œ ì‹œì‘, QA í›„ `true`ë¡œ ì „í™˜ ê¶Œì¥

**Implementation Items:**

- [x] **P4-01**: ì½˜ì†” ë¡œê·¸ ë° ì„ì‹œ ì½”ë“œ ì •ë¦¬ âœ… (2026-01-17 ì™„ë£Œ)
  - `Target`: ëª¨ë“  ì‹ ê·œ íŒŒì¼ (`MutedMark.ts`, `RichShadowWriter.tsx`)
  - `Logic`: `console.log` ì œê±°, ì£¼ì„ ì •ë¦¬
  - `Safety`: `logger` ì‚¬ìš© ê¶Œì¥ (`@/lib/utils/logger`)

- [ ] **P4-02**: Vercel í™˜ê²½ë³€ìˆ˜ ë“±ë¡
  - `Target`: Vercel Dashboard > Settings > Environment Variables
  - `Logic`:
    ```
    NEXT_PUBLIC_ENABLE_RICH_SHADOW_WRITER=true  (Productionì—ì„  ì²˜ìŒì— false)
    ```

- [ ] **P4-03**: Git ì»¤ë°‹ ë° ë°°í¬
  - `Logic`:
    ```bash
    git add .
    git commit -m "Feature: Rich Shadow Writer with Muted Text (TipTap migration)"
    git push origin main
    ```

**Definition of Done (ê²€ì¦):**

- [ ] `npm run build` ì„±ê³µ (exit code 0)
- [ ] Vercel ë°°í¬ ì„±ê³µ (Build & Deploy â†’ Green)
- [ ] í”„ë¡œë•ì…˜ì—ì„œ Feature Flag í™œì„±í™” í›„ Mute ê¸°ëŠ¥ ë™ì‘ í™•ì¸

---

## [ìš”ì•½: ì˜ˆìƒ ì‘ì—… ì‹œê°„]

| Phase     | ì˜ˆìƒ ì‹œê°„         | ë¹„ê³                |
| --------- | ----------------- | ------------------ |
| P0        | 5ë¶„               | npm install        |
| P1        | 30ë¶„              | Extension + CSS    |
| P2        | 1ì‹œê°„             | í•µì‹¬ ì»´í¬ë„ŒíŠ¸ êµ¬ì¶• |
| P3        | 30ë¶„              | í†µí•© ë° Flag       |
| P4        | 15ë¶„              | ì •ë¦¬ ë° ë°°í¬       |
| **Total** | **ì•½ 2ì‹œê°„ 20ë¶„** |                    |

---

**ì‘ì„±ì**: Tech Lead (AI Assistant)
**ê²€í†  ìš”ì²­**: í”„ë¡ íŠ¸ì—”ë“œ ê°œë°œìë‹˜ê»˜ì„œ P1ë¶€í„° ìˆœì°¨ ì§„í–‰ ë¶€íƒë“œë¦½ë‹ˆë‹¤. ğŸ™
