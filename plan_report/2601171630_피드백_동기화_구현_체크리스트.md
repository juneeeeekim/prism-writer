# í”¼ë“œë°± ë™ê¸°í™” êµ¬í˜„ ì²´í¬ë¦¬ìŠ¤íŠ¸

**ì‘ì„±ì¼**: 2026-01-17  
**ì‘ì„±ì**: Tech Lead  
**ê¸°ë°˜ ë¬¸ì„œ**: `2601171628_í”¼ë“œë°±_ë™ê¸°í™”_êµ¬í˜„_ê³„íšì„œ.md`

---

## [Phase 1: ë°±ì—”ë“œ API ìˆ˜ì •]

**Before Start:**

- âš ï¸ ì£¼ì˜: `GET /api/chat/sessions/[id]` ê¸°ì¡´ ì‘ë‹µ êµ¬ì¡°(`{ session, messages }`)ë¥¼ ìœ ì§€í•´ì•¼ í•¨
- âš ï¸ ë ˆê±°ì‹œ: `chat_messages` í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ ë³€ê²½ ê¸ˆì§€ (ê¸°ì¡´ í´ë¼ì´ì–¸íŠ¸ í˜¸í™˜ì„±)

**Implementation Items:**

- [x] **P1-01**: í”¼ë“œë°± ì¡°íšŒ ë¡œì§ ì¶”ê°€ âœ… (2026-01-17 ì™„ë£Œ)
  - `Target`: `frontend/src/app/api/chat/sessions/[id]/route.ts` > `GET()`
  - `Logic (Pseudo)`:

    ```
    // 1. ê¸°ì¡´ session ì¡°íšŒ (ë³€ê²½ ì—†ìŒ)
    const { session } = await getSession(id, user.id)

    // 2. ê¸°ì¡´ messages ì¡°íšŒ (ë³€ê²½ ì—†ìŒ)
    const { messages } = await getMessages(id)

    // 3. [NEW] í•´ë‹¹ í”„ë¡œì íŠ¸ì˜ í”¼ë“œë°± ì´ë²¤íŠ¸ ì¡°íšŒ
    const feedbackEvents = await supabase
      .from('learning_events')
      .select('event_type, event_data')
      .eq('user_id', user.id)
      .eq('project_id', session.project_id)
      .in('event_type', ['chat_helpful', 'chat_not_helpful', 'chat_hallucination'])

    // 4. [NEW] ë©”ì‹œì§€ì— í”¼ë“œë°± ë§¤í•‘
    const messagesWithFeedback = messages.map(msg => ({
      ...msg,
      feedback: feedbackEvents.find(
        f => f.event_data?.messageId === msg.id
      )?.event_type ?? null
    }))

    // 5. ì‘ë‹µ ë°˜í™˜ (feedback í•„ë“œ ì¶”ê°€ë¨)
    return { session, messages: messagesWithFeedback }
    ```

  - `Key Variables`:
    - `feedbackEvents`: `learning_events` ì¡°íšŒ ê²°ê³¼ ë°°ì—´
    - `messagesWithFeedback`: í”¼ë“œë°± ë§¤í•‘ëœ ë©”ì‹œì§€ ë°°ì—´
  - `Safety`:
    - `feedbackEvents` ì¡°íšŒ ì‹¤íŒ¨ ì‹œ ë¹ˆ ë°°ì—´(`[]`)ë¡œ fallback
    - `event_data?.messageId` null-safe ì ‘ê·¼ í•„ìˆ˜
    - try-catchë¡œ ì „ì²´ ë¡œì§ ê°ì‹¸ê¸°

---

## [Phase 2: í”„ë¡ íŠ¸ì—”ë“œ íƒ€ì… ë° ë§¤í•‘ ìˆ˜ì •]

**Before Start:**

- âš ï¸ ì£¼ì˜: `Message` ì¸í„°í˜ì´ìŠ¤ ë³€ê²½ ì‹œ ëª¨ë“  ì‚¬ìš©ì²˜ í™•ì¸ í•„ìš”
- âš ï¸ ë ˆê±°ì‹œ: `message.metadata` êµ¬ì¡°ëŠ” ìœ ì§€ (citation_verification, sources ë“±)

**Implementation Items:**

- [x] **P2-01**: `Message` ì¸í„°í˜ì´ìŠ¤ì— `feedback` í•„ë“œ ì¶”ê°€ âœ… (2026-01-17 ì™„ë£Œ)
  - `Target`: `frontend/src/components/Assistant/ChatTab.tsx` > `interface Message`
  - `Logic (Pseudo)`:
    ```typescript
    interface Message {
      id: string
      role: 'user' | 'assistant'
      content: string
      timestamp: Date
      metadata?: { ... }
      // [NEW] í”¼ë“œë°± ìƒíƒœ
      feedback?: 'chat_helpful' | 'chat_not_helpful' | 'chat_hallucination' | null
    }
    ```
  - `Key Variables`: `feedback` (optional SignalType)
  - `Safety`: optional í•„ë“œì´ë¯€ë¡œ ê¸°ì¡´ ì½”ë“œì— ì˜í–¥ ì—†ìŒ

- [x] **P2-02**: ë©”ì‹œì§€ ë¡œë“œ ì‹œ `feedback` í•„ë“œ ë§¤í•‘ âœ… (2026-01-17 ì™„ë£Œ)
  - `Target`: `frontend/src/components/Assistant/ChatTab.tsx` > `loadMessages()`, `refreshMessages()`
  - `Logic (Pseudo)`:
    ```typescript
    const loadedMessages = data.messages.map((m: any) => ({
      id: m.id,
      role: m.role,
      content: m.content,
      timestamp: new Date(m.created_at),
      metadata: m.metadata,
      feedback: m.feedback ?? null, // [NEW] í”¼ë“œë°± ë§¤í•‘
    }));
    ```
  - `Key Variables`: `m.feedback` (API ì‘ë‹µì—ì„œ ì¶”ê°€ëœ í•„ë“œ)
  - `Safety`: `m.feedback ?? null`ë¡œ undefined ë°©ì–´

- [x] **P2-03**: `AdaptiveFeedbackButtons`ì— `initialFeedback` prop ì „ë‹¬ âœ… (2026-01-17 ì™„ë£Œ)
  - `Target`: `frontend/src/components/Assistant/ChatTab.tsx` > JSX ë Œë”ë§ ë¶€ë¶„
  - `Logic (Pseudo)`:
    ```tsx
    <AdaptiveFeedbackButtons
      messageId={message.id}
      projectId={projectId}
      initialFeedback={message.feedback} // [NEW]
    />
    ```
  - `Key Variables`: `message.feedback`
  - `Safety`: ì—†ìŒ (optional prop)

---

## [Phase 3: í”¼ë“œë°± ë²„íŠ¼ ì»´í¬ë„ŒíŠ¸ ìˆ˜ì •]

**Before Start:**

- âš ï¸ ì£¼ì˜: ê¸°ì¡´ `submitted` ìƒíƒœ ë¡œì§ ìœ ì§€í•˜ë©´ì„œ ì´ˆê¸°ê°’ë§Œ ë³€ê²½

**Implementation Items:**

- [x] **P3-01**: `initialFeedback` prop ì¶”ê°€ ë° ìƒíƒœ ì´ˆê¸°í™” âœ… (2026-01-17 ì™„ë£Œ)
  - `Target`: `frontend/src/components/chat/AdaptiveFeedbackButtons.tsx`
  - `Logic (Pseudo)`:

    ```typescript
    interface AdaptiveFeedbackButtonsProps {
      messageId: string;
      projectId: string;
      onFeedbackSubmit?: (type: SignalType) => void;
      initialFeedback?: SignalType | null; // [NEW]
    }

    export default function AdaptiveFeedbackButtons({
      messageId,
      projectId,
      onFeedbackSubmit,
      initialFeedback, // [NEW]
    }: AdaptiveFeedbackButtonsProps) {
      // [CHANGED] ì´ˆê¸°ê°’ì„ propì—ì„œ ë°›ìŒ
      const [submitted, setSubmitted] = useState<SignalType | null>(
        initialFeedback ?? null,
      );
      // ... ë‚˜ë¨¸ì§€ ë¡œì§ ë™ì¼
    }
    ```

  - `Key Variables`:
    - `initialFeedback`: ì„œë²„ì—ì„œ ë°›ì€ ê¸°ì¡´ í”¼ë“œë°± ìƒíƒœ
    - `submitted`: ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ ìƒíƒœ (ì´ˆê¸°ê°’ = initialFeedback)
  - `Safety`: `initialFeedback ?? null`ë¡œ undefined ë°©ì–´

---

## [Phase 4: ê²€ì¦]

**Definition of Done (ê²€ì¦):**

- [ ] **DoD-01**: ë‹¨ì¼ ê¸°ê¸° ë™ì‘ í™•ì¸ â†’ **ìˆ˜ë™ í…ŒìŠ¤íŠ¸ í•„ìš”** (ë¡œê·¸ì¸ í•„ìš”)
  - `Test`: A PCì—ì„œ í”¼ë“œë°±(ğŸ‘) í´ë¦­ â†’ ìƒˆë¡œê³ ì¹¨ â†’ í”¼ë“œë°± ìƒíƒœ ìœ ì§€ í™•ì¸
  - `Expected`: ë²„íŠ¼ ëŒ€ì‹  "âœ“ í”¼ë“œë°± ê°ì‚¬í•©ë‹ˆë‹¤ ğŸ‘" í‘œì‹œ

- [ ] **DoD-02**: ë©€í‹° ê¸°ê¸° ë™ê¸°í™” í™•ì¸ â†’ **ìˆ˜ë™ í…ŒìŠ¤íŠ¸ í•„ìš”** (ë¡œê·¸ì¸ í•„ìš”)
  - `Test`: A PCì—ì„œ í”¼ë“œë°± â†’ B PCì—ì„œ ê°™ì€ ì±„íŒ… ì„¸ì…˜ ì—´ê¸°
  - `Expected`: B PCì—ì„œë„ ë™ì¼í•œ í”¼ë“œë°± ìƒíƒœ í‘œì‹œ

- [ ] **DoD-03**: ì˜ˆì™¸ ì²˜ë¦¬ í™•ì¸ â†’ **ì½”ë“œ ë¦¬ë·°ë¡œ í™•ì¸ ì™„ë£Œ** (graceful degradation êµ¬í˜„ë¨)
  - `Test`: `learning_events` í…Œì´ë¸” ì¡°íšŒ ì‹¤íŒ¨ ì‹œë®¬ë ˆì´ì…˜
  - `Expected`: ë©”ì‹œì§€ëŠ” ì •ìƒ ë¡œë“œë˜ê³ , í”¼ë“œë°±ë§Œ null (ë²„íŠ¼ í‘œì‹œ)

- [ ] **DoD-04**: ì„±ëŠ¥ í™•ì¸ â†’ **ìˆ˜ë™ í…ŒìŠ¤íŠ¸ í•„ìš”** (ëŒ€ëŸ‰ ë©”ì‹œì§€ ì„¸ì…˜)
  - `Test`: ë©”ì‹œì§€ 100ê°œ ì´ìƒì¸ ì„¸ì…˜ ë¡œë“œ
  - `Expected`: ì¡°íšŒ ì‹œê°„ +500ms ì´ë‚´ (ê¸°ì¡´ ëŒ€ë¹„)

- [x] **DoD-05**: ì½”ë“œ í’ˆì§ˆ âœ… (2026-01-17 ì™„ë£Œ)
  - `Review`: ë¶ˆí•„ìš”í•œ `console.log` ì œê±°
  - `Review`: ìƒˆ ë¡œì§ì— ì£¼ì„ ì¶”ê°€ (`// [Feedback Sync]` íƒœê·¸)
  - `Review`: `npx tsc --noEmit` 0 errors

---

## ì˜í–¥ë°›ëŠ” íŒŒì¼ ëª©ë¡

| íŒŒì¼                                                       | ë³€ê²½ ë‚´ìš©                           |
| ---------------------------------------------------------- | ----------------------------------- |
| `frontend/src/app/api/chat/sessions/[id]/route.ts`         | í”¼ë“œë°± ì¡°íšŒ ë° ë§¤í•‘ ë¡œì§ ì¶”ê°€       |
| `frontend/src/components/Assistant/ChatTab.tsx`            | Message íƒ€ì…, ë¡œë“œ ë§¤í•‘, prop ì „ë‹¬  |
| `frontend/src/components/chat/AdaptiveFeedbackButtons.tsx` | initialFeedback prop ë° ìƒíƒœ ì´ˆê¸°í™” |

---

## ìŠ¹ì¸ ìš”ì²­

ìœ„ ì²´í¬ë¦¬ìŠ¤íŠ¸ëŒ€ë¡œ êµ¬í˜„ì„ ì§„í–‰í•´ë„ ë ê¹Œìš”?
