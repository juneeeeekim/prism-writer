# ê¸°ìˆ  ê°œë°œ ë¬¸ì„œ: AI Structurer (AI êµ¬ì¡° ìµœì í™” ì—”ì§„)

**ë¬¸ì„œ ë²ˆí˜¸:** 260107_AI_Structurer_Architecture
**ì‘ì„±ì¼:** 2026-01-07
**ì‘ì„±ì:** Antigravity (System Architect) & Expert Team
**ìƒíƒœ:** Draft (ì„¤ê³„ ë‹¨ê³„)

---

## 1. ê°œìš” (Overview)

### 1.1. ëª©ì 

ë³¸ ë¬¸ì„œëŠ” PRISM Writerì— **"ëª¨ë“ˆí˜• ê¸€ì“°ê¸° ë° AI êµ¬ì¡° ìµœì í™”(AI Structurer)"** ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ê¸° ìœ„í•œ ê¸°ìˆ ì  ì•„í‚¤í…ì²˜ë¥¼ ì •ì˜í•œë‹¤.
ì‚¬ìš©ìê°€ ë ˆê³  ë¸”ë¡ì²˜ëŸ¼ ë¬¸ì„œë¥¼ ì‘ì„±í•˜ê³ , AIê°€ RAG ë° Rubric ì—”ì§„ì„ í™œìš©í•˜ì—¬ ìµœì ì˜ ë¬¸ì„œ ë°°ì¹˜ ìˆœì„œë¥¼ ì œì•ˆí•˜ê±°ë‚˜ ëˆ„ë½ëœ ë‚´ìš©ì„ ì¡°ì–¸í•˜ëŠ” ê¸°ëŠ¥ì„ êµ¬í˜„í•œë‹¤.

### 1.2. í•µì‹¬ ì›ì¹™ (Core Principles)

1.  **Non-Breaking Upgrade (ë¬´ì¤‘ë‹¨ ì—…ê·¸ë ˆì´ë“œ)**: ê¸°ì¡´ ì‹œìŠ¤í…œ(Outline, Evaluation, Chat ë“±)ì˜ ì‘ë™ì„ ì ˆëŒ€ ë°©í•´í•˜ì§€ ì•Šìœ¼ë©°, ê¸°ì¡´ DB ìŠ¤í‚¤ë§ˆì™€ 100% í˜¸í™˜ë˜ì–´ì•¼ í•œë‹¤.
2.  **RAG-Native Design (RAG ê¸°ë°˜ ì„¤ê³„)**: ë‹¨ìˆœ LLM í˜¸ì¶œì´ ì•„ë‹Œ, í˜„ì¬ êµ¬ì¶•ëœ **Vector Store**ì™€ **Retrieval Pipeline**ì„ í•µì‹¬ ì—”ì§„ìœ¼ë¡œ í™œìš©í•œë‹¤.
3.  **Strict Isolation (ì—„ê²©í•œ ê²©ë¦¬)**: `083` íŒ¨ì¹˜ë¡œ ì ìš©ëœ í”„ë¡œì íŠ¸ ê²©ë¦¬ ì •ì±…ì„ ì² ì €íˆ ì¤€ìˆ˜í•œë‹¤.

---

## 2. ì•„í‚¤í…ì²˜ ì„¤ê³„ (Architecture Design)

ìš°ë¦¬ì˜ ì„œë¹„ìŠ¤ëŠ” RAG ì‹œìŠ¤í…œ(Foundation) ìœ„ì— êµ¬ì¶•ë©ë‹ˆë‹¤. ì´ë²ˆ ì—…ê·¸ë ˆì´ë“œëŠ” ê¸°ì¡´ Foundationì„ ìˆ˜ì •í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼, **ìƒˆë¡œìš´ Application Layer**ë¥¼ ì¶”ê°€í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.

```mermaid
graph TD
    subgraph "Existing Core Layer (Stable)"
        DB[(Supabase DB <br/> Projects / Documents / Chunks)]
        Vec[Vector Store <br/> (pgvector)]
        RAG[RAG Engine <br/> (Retrieval / Hybrid Search)]
    end

    subgraph "New Feature Layer (AI Structurer)"
        Analyzer[Structure Analyzer <br/> (LLM + Logic)]
        Reorder[Reorder Algorithm]
        GapDetector[Gap Detector]
    end

    User --> |Write Blocks| DB
    User --> |Request Optimization| Analyzer
    Analyzer --> |Fetch Document Embeddings| Vec
    Analyzer --> |Retrieve Contex| RAG
    Analyzer --> |Suggest Order & Gaps| User
```

### 2.1. ë°ì´í„° íë¦„ (Data Flow)

1.  **Input**: ì‚¬ìš©ìì˜ í˜„ì¬ í”„ë¡œì íŠ¸ ë‚´ ë¬¸ì„œ ë¦¬ìŠ¤íŠ¸ (`projectId` ê¸°ë°˜ ì¡°íšŒ).
2.  **Process**:
    - **Vector Analysis**: ê° ë¬¸ì„œ(ë¸”ë¡)ì˜ ë²¡í„°ê°’(Centroid)ì„ ë¶„ì„í•˜ì—¬ ë‚´ìš©ì  ìœ ì‚¬ë„ì™€ íë¦„ì„ íŒŒì•….
    - **LLM Evaluation**: RAGë¥¼ í†µí•´ ê° ë¬¸ì„œì˜ ìš”ì•½ë³¸ì„ ì¶”ì¶œí•˜ê³ , ì „ì²´ ê¸€ì˜ ë…¼ë¦¬ì  íë¦„(ì„œë¡ -ë³¸ë¡ -ê²°ë¡ )ì— ë§ëŠ”ì§€ í‰ê°€.
    - **Rubric Check**: ì‚¬ìš©ìê°€ ì„¤ì •í•œ ëª©í‘œ(í…œí”Œë¦¿)ì— ë”°ë¼ í•„ìˆ˜ ìš”ì†Œ(ì˜ˆ: ì—°êµ¬ ë°°ê²½, ê²°ë¡  ë„ì¶œ ë“±)ê°€ í¬í•¨ë˜ì—ˆëŠ”ì§€ í™•ì¸.
3.  **Output**:
    - ì¶”ì²œ ì •ë ¬ ìˆœì„œ (Reordered List)
    - ë°œê²¬ëœ ê³µë°± (Missing Parts) ì œì•ˆ
    - ì—°ê²° ê³ ë¦¬ (Bridge) ë¬¸êµ¬ ì œì•ˆ

---

## 3. ìƒì„¸ êµ¬í˜„ ê³„íš (Implementation Plan)

### 3.1. Database (Schema Additions)

**ê¸°ì¡´ í…Œì´ë¸”ì„ ê±´ë“œë¦¬ì§€ ì•Šê³ **, ìˆœì„œ ì •ë³´ë¥¼ ì €ì¥í•˜ê±°ë‚˜ ë¶„ì„ ê²°ê³¼ë¥¼ ìºì‹±í•˜ê¸° ìœ„í•œ ë©”íƒ€ë°ì´í„° ì»¬ëŸ¼/í…Œì´ë¸”ë§Œ ì¶”ê°€í•©ë‹ˆë‹¤. (Safe Upgrade)

- **`documents` í…Œì´ë¸” í™•ì¥ (Optional)**:
  - `sort_order` (float): ì‚¬ìš©ìê°€ ì§€ì •í•œ(ë˜ëŠ” AIê°€ ì œì•ˆí•œ) ì •ë ¬ ìˆœì„œë¥¼ ì €ì¥. (ê¸°ì¡´ì—ë„ `order` ë“±ì˜ í•„ë“œê°€ ìˆë‹¤ë©´ ì¬í™œìš©)
  - `logic_tag` (string): AIê°€ ë¶„ì„í•œ ë¬¸ì„œì˜ ì—­í•  (ì˜ˆ: Intro, Body, Conclusion).

### 3.2. Backend API (`/api/rag/structure`)

ìƒˆë¡œìš´ ì—”ë“œí¬ì¸íŠ¸ ì„¸íŠ¸ë¥¼ ì‹ ì„¤í•˜ì—¬ ê¸°ì¡´ APIì™€ì˜ ì¶©ëŒì„ ë°©ì§€í•©ë‹ˆë‹¤.

1.  **`POST /api/rag/structure/analyze`**

    - **Input**: `projectId`, `targetTemplateId` (ì„ íƒ)
    - **Action**:
      1.  í”„ë¡œì íŠ¸ ë‚´ ëª¨ë“  ë¬¸ì„œì˜ `content` ë˜ëŠ” `summary`ë¥¼ ë¡œë“œ.
      2.  RAGë¥¼ í†µí•´ ê° ë¬¸ì„œì˜ í•µì‹¬ í‚¤ì›Œë“œ ì¶”ì¶œ.
      3.  **Metadata-Aware**: ë¬¸ì„œ ë‚´ìš©ë¿ë§Œ ì•„ë‹ˆë¼ ë©”íƒ€ë°ì´í„°(íƒœê·¸, ìƒì„±ì¼, ì°¸ì¡° íšŸìˆ˜)ë¥¼ í¬í•¨í•˜ì—¬ í”„ë¡¬í”„íŠ¸ êµ¬ì„±.
      4.  **[Key] Dynamic Rubric Mapping**:
          - ì‚¬ìš©ìê°€ ì„ íƒí•œ **Template(Rubric)**ì„ ì œ1ë²ˆ ê¸°ì¤€ìœ¼ë¡œ ì‚¼ìŠµë‹ˆë‹¤.
          - ë‹¨ìˆœí•œ "ì„œë¡ /ë³¸ë¡ /ê²°ë¡ "ì´ ì•„ë‹Œ, í…œí”Œë¦¿ì— ì •ì˜ëœ ì‹¤ì œ êµ¬ì¡°(ì˜ˆ: 'ê¸°ìŠ¹ì „ê²°', 'ì—°êµ¬ë°°ê²½-ì‹¤í—˜-ê²°ê³¼', 'ë°œë‹¨-ì „ê°œ-ì ˆì •')ì— ë§ì¶° ë¬¸ì„œë¥¼ ë¶„ë¥˜í•˜ê³  íƒœê·¸ë¥¼ ìƒì„±í•˜ë¼ëŠ” í”„ë¡¬í”„íŠ¸ë¥¼ ì „ì†¡í•©ë‹ˆë‹¤.
      5.  LLMì—ê²Œ "ìœ„ ë£¨ë¸Œë¦­ ê¸°ì¤€ì— ë”°ë¼ ì´ ë¬¸ì„œë“¤ì„ ë…¼ë¦¬ì ìœ¼ë¡œ ì¬ë°°ì—´í•˜ë¼"ëŠ” ëª…ë ¹ ì‹¤í–‰.
      6.  ë¬¸ì„œ ê°„ì˜ ì—°ê²°ì„±ì´ ì•½í•œ êµ¬ê°„ íƒì§€ (Gap Analysis).

    * **Output**: ì¶”ì²œ ìˆœì„œ ë¦¬ìŠ¤íŠ¸, ê° êµ¬ê°„ë³„ ì¡°ì–¸(Advice).

2.  **`POST /api/documents/reorder`** (ê¸°ì¡´ Batch Update í™œìš© ê°€ëŠ¥)
    - **Action**: ì‚¬ìš©ìê°€ AI ì œì•ˆì„ ìˆ˜ë½í•˜ë©´ DBì— ìˆœì„œ ì—…ë°ì´íŠ¸.

### 3.3. Frontend UI (New View: Structure Board)

ê¸°ì¡´ `OutlineTab`ì´ë‚˜ `Editor`ë¥¼ ë§ê°€ëœ¨ëœ¨ë¦¬ì§€ ì•Šê¸° ìœ„í•´, **'Structure Board'**ë¼ëŠ” ìƒˆë¡œìš´ íƒ­ì„ ì¶”ê°€í•©ë‹ˆë‹¤.

- **Structure Board**:
  - **Dashboard**: í˜„ì¬ í”„ë¡œì íŠ¸ì˜ êµ¬ì¡°ì  ì™„ì„±ë„ë¥¼ ë³´ì—¬ì£¼ëŠ” ê²Œì´ì§€ (ì˜ˆ: ë…¼ë¦¬ì  ì—°ê²°ì„± 85%).
  - **Main Canvas**: ë¬¸ì„œë¥¼ ì¹´ë“œ í˜•íƒœë¡œ ì‹œê°í™”í•œ ë¬´í•œ ìº”ë²„ìŠ¤ ë˜ëŠ” ë¦¬ìŠ¤íŠ¸.
  - **Unsorted Bin (ë¯¸ë¶„ë¥˜ ë³´ê´€í•¨)**: êµ¬ì¡°ì— í¬í•¨ë˜ì§€ ì•Šì€ ì•„ì´ë””ì–´/ë©”ëª¨ ì¹´ë“œë¥¼ ë³´ê´€í•˜ëŠ” ë³„ë„ ì˜ì—­.
  - **AI Side Panel**: êµ¬ì¡° ë¶„ì„ ê²°ê³¼ ë° ì œì•ˆ ì‚¬í•­ì„ ëŒ€í™”í˜•ìœ¼ë¡œ í‘œì‹œ.

---

## 4. ê¸°ì¡´ ì‹œìŠ¤í…œ ë³´í˜¸ ì „ëµ (Stability Strategy)

1.  **API ë¶„ë¦¬**: `structure` ê´€ë ¨ APIëŠ” ì™„ì „íˆ ë³„ë„ì˜ íŒŒì¼ë¡œ ìƒì„±í•˜ì—¬, ê¸°ì¡´ `outline`, `evaluate` APIì— 1ë°”ì´íŠ¸ì˜ ì˜í–¥ë„ ì£¼ì§€ ì•ŠëŠ”ë‹¤.
2.  **Feature Flag**: `ENABLE_AI_STRUCTURER` í”Œë˜ê·¸ë¥¼ ë„ì…í•˜ì—¬, ê°œë°œ ì¤‘ì—ëŠ” ì¼ë°˜ ì‚¬ìš©ìì—ê²Œ ë…¸ì¶œë˜ì§€ ì•Šë„ë¡ ì œì–´í•œë‹¤.
3.  **Read-Only Analysis**: AI ë¶„ì„ ë‹¨ê³„ì—ì„œëŠ” DBì— ì“°ê¸° ì‘ì—…ì„ ìˆ˜í–‰í•˜ì§€ ì•Šê³  ì˜¤ì§ **ì œì•ˆ(Suggestion)**ë§Œ ë¦¬í„´í•œë‹¤. ì‚¬ìš©ìê°€ [ì ìš©]ì„ ëˆ„ë¥¼ ë•Œë§Œ DBê°€ ì—…ë°ì´íŠ¸ë˜ë¯€ë¡œ ë°ì´í„° ì˜¤ì—¼ ìœ„í—˜ì´ ì—†ë‹¤.

---

## 5. ì‹¤í–‰ ë¡œë“œë§µ (Execution Roadmap)

- **Phase 1: API ì„¤ê³„ ë° êµ¬í˜„**
  - í”„ë¡œì íŠ¸ ë‚´ ë¬¸ì„œ ì¼ê´„ ì¡°íšŒ ë° LLM ë¶„ì„ í”„ë¡¬í”„íŠ¸ ì—”ì§€ë‹ˆì–´ë§.
  - êµ¬ì¡° ë¶„ì„ API ê°œë°œ.
- **Phase 2: UI í”„ë¡œí† íƒ€ì…**
  - Frontendì— 'Structure Tab' ì¶”ê°€.
  - ë¬¸ì„œ ëª©ë¡ Drag & Drop ë° AI í”¼ë“œë°± í‘œì‹œ UI êµ¬í˜„.
- **Phase 3: RAG íŒŒì´í”„ë¼ì¸ ì—°ë™**
  - ë‹¨ìˆœ í…ìŠ¤íŠ¸ ê¸°ë°˜ ë¶„ì„ì„ ë„˜ì–´, ë²¡í„° ìœ ì‚¬ë„ë¥¼ í™œìš©í•œ ì •ë°€ ë¶„ì„ ë¡œì§ ì¶”ê°€.
- **Phase 4: í†µí•© í…ŒìŠ¤íŠ¸**
  - ëŒ€ê·œëª¨ í”„ë¡œì íŠ¸(ë¬¸ì„œ 10ê°œ ì´ìƒ)ì—ì„œì˜ ì„±ëŠ¥ ë° ì •í™•ë„ ê²€ì¦.

---

## 6. UI/UX ë””ìì¸ ëª…ì„¸ (UX Design Specs)

ì „ë¬¸ê°€ íšŒì˜(UX Designer, HCI Expert)ë¥¼ ë°˜ì˜í•œ ìƒì„¸ ë””ìì¸ ëª…ì„¸ì…ë‹ˆë‹¤.

### 6.1. ì¹´ë“œí˜• ì¸í„°í˜ì´ìŠ¤ (Tactile Card UI)

ë¬¸ì„œë¥¼ ë‹¨ìˆœí•œ í…ìŠ¤íŠ¸ ì¤„ì´ ì•„ë‹Œ, ì¡°ì‘ ê°€ëŠ¥í•œ 'ë¬¼ì²´(Object)'ë¡œ ì‹œê°í™”í•©ë‹ˆë‹¤.

- **Card Components**:
  - **Header**: ë¬¸ì„œ ì œëª© (ë“œë˜ê·¸ í•¸ë“¤ ì—­í• ).
  - **Body Preview**: ë¬¸ì„œ ë‚´ìš©ì˜ í•µì‹¬ 3ì¤„ ìš”ì•½.
  - **Dynamic Tag Line**: AIê°€ ë¶„ì„í•œ ì—­í•  íƒœê·¸.
    - ê³ ì •ëœ(ì„œë¡ /ë³¸ë¡ /ê²°ë¡ ) íƒœê·¸ê°€ ì•„ë‹˜.
    - **RAG í…œí”Œë¦¿ì— ì •ì˜ëœ ê¸°ì¤€**ì„ ì ìš© (ì˜ˆ: ï¿½ ì—°êµ¬ë°©ë²•ë¡ , ï¿½ ì‹¤í—˜ê²°ê³¼, ğŸ¬ ë°œë‹¨, âš¡ ì ˆì •).
  - **Connection Badge**: ì´ì „/ë‹¤ìŒ ë¬¸ì„œì™€ì˜ ë…¼ë¦¬ì  ì—°ê²° ì ìˆ˜ í‘œì‹œ (ì˜ˆ: ğŸ”— 98%).

### 6.2. ì¸í„°ë™ì…˜ (Interaction)

- **Auto-Sort Animation (framer-motion)**:
  - AI ì œì•ˆ [ì ìš©] ë²„íŠ¼ í´ë¦­ ì‹œ, ì¹´ë“¤ì´ ë¬¼ íë¥´ë“¯ ìë™ìœ¼ë¡œ ì œ ìœ„ì¹˜ë¡œ ì´ë™í•˜ëŠ” ì• ë‹ˆë©”ì´ì…˜ì„ ì œê³µí•˜ì—¬ ì‚¬ìš©ìì—ê²Œ ì¾Œê°ì„ ì¤ë‹ˆë‹¤.

### 6.3. ê³µë°± ì‹œê°í™” (Gap Visualization)

ë…¼ë¦¬ì  ë¹„ì•½ì´ ìˆëŠ” êµ¬ê°„ì„ ì‹œê°ì ìœ¼ë¡œ ê²½ê³ í•©ë‹ˆë‹¤.

- **Visual Metaphor**: ì¹´ë“œ ì‚¬ì´ê°€ ì°¢ì–´ì§„ ì¢…ì´ì²˜ëŸ¼ í‘œí˜„ë˜ê±°ë‚˜, ë¶‰ì€ìƒ‰ ì ì„ ìœ¼ë¡œ ì—°ê²°ì´ ëŠê²¨ ìˆìŒì„ ë³´ì—¬ì¤ë‹ˆë‹¤.
- **Draft Generation**: ëŠê¸´ êµ¬ê°„ì„ í´ë¦­í•˜ë©´ "AIê°€ ì´ ì‚¬ì´ë¥¼ ë©”ê¿€ ë¸Œë¦¿ì§€ ë¬¸ë‹¨ì„ ì œì•ˆí•©ë‹ˆë‹¤"ë¼ëŠ” íŒì—…ê³¼ í•¨ê»˜ [ì´ˆì•ˆ ìƒì„±] ë²„íŠ¼ì´ ë…¸ì¶œë©ë‹ˆë‹¤.

### 6.4. ë¹„êµ ëª¨ë“œ (Diff View)

- **Before & After**: í˜„ì¬ ì‚¬ìš©ìì˜ ë°°ì¹˜ì™€ AIì˜ ì¶”ì²œ ë°°ì¹˜ë¥¼ ì¢Œìš°ë¡œ(ë˜ëŠ” ìƒí•˜ë¡œ) ë¹„êµí•˜ì—¬, ì‚¬ìš©ìê°€ AIì˜ ì˜ë„ë¥¼ ëª…í™•íˆ ì´í•´í•˜ê³  ì„ íƒí•  ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.

---

## 7. í–¥í›„ ë°œì „ ê³„íš (Future Scope)

### 7.1. ê°œì¸í™” í•™ìŠµ ë£¨í”„ (Feedback Loop)

- ì‚¬ìš©ìê°€ AIì˜ ì¶”ì²œ("A->B")ì„ ê±°ë¶€í•˜ê³  ë‹¤ë¥¸ ì„ íƒ("B->A")ì„ í–ˆì„ ë•Œ, ì´ í–‰ë™ ë°ì´í„°ë¥¼ ë¡œê¹…í•©ë‹ˆë‹¤.
- ì¶•ì ëœ ë°ì´í„°ë¥¼ ë°”íƒ•ìœ¼ë¡œ "ì´ ì‘ê°€ëŠ” 'ë‘ê´„ì‹' êµ¬ì„±ì„ ì„ í˜¸í•œë‹¤"ëŠ” íŒ¨í„´ì„ í•™ìŠµí•˜ì—¬, ë‹¤ìŒ ë¶„ì„ ì‹œ ë§ì¶¤í˜• ì œì•ˆì„ ì œê³µí•©ë‹ˆë‹¤.

---

### [ì „ë¬¸ê°€ ì„œëª…]

- **System Architect**: Antigravity ğŸ–‹ï¸
- **Content Strategist**: Approved
- **AI Researcher**: Approved
- **UX Designer**: Approved (New)
- **HCI Expert**: Approved (New)
