# Phase 4: RAFT 파인튜닝 준비 - 간섭 분석 회의

> **분석일**: 2025-12-27  
> **참석자**: 시니어 개발자, 주니어 개발자, UX/UI 전문가  
> **분석 대상**: Phase 4 RAFT 파인튜닝 관련 신규 기능

---

## 📋 분석 대상

| 기능                 | 파일 예상 위치                        | 유형      |
| -------------------- | ------------------------------------- | --------- |
| SFT 데이터셋 테이블  | `migrations/039_raft_dataset.sql`     | 신규      |
| LLM 합성 데이터 생성 | `lib/raft/syntheticDataGenerator.ts`  | 신규      |
| 관리자 큐레이션 기능 | `app/admin/feedback/page.tsx`         | 기존 확장 |
| 피드백 → RAFT 변환   | `api/feedback/hallucination/route.ts` | 기존 확장 |

---

## 1️⃣ UI 간섭 분석

### 🧑‍💼 시니어 개발자 분석

| 항목          | 위험 여부 | 설명                                                  |
| ------------- | --------- | ----------------------------------------------------- |
| 화면 겹침     | 🟢 낮음   | 관리자 대시보드에 버튼/탭 추가만 - 기존 레이아웃 유지 |
| 스타일 충돌   | 🟢 낮음   | 기존 Tailwind 클래스 재사용 - 신규 스타일 최소화      |
| 레이아웃 깨짐 | 🟡 중간   | 큐레이션 모달 추가 시 z-index 충돌 가능성             |

### 👨‍💻 주니어 개발자 보완

> "관리자 대시보드의 FeedbackCard 컴포넌트에 '저장' 버튼을 추가할 때, 기존 버튼들과 정렬이 깨질 수 있습니다. flex 레이아웃 확인 필요."

### 🎨 UX/UI 전문가 의견

> "큐레이션 UI는 기존 피드백 목록과 시각적으로 구분되어야 합니다. 배지(badge)나 아이콘으로 'RAFT 저장됨' 상태를 표시하면 좋겠습니다."

---

## 2️⃣ 기능 간섭 분석

### 🧑‍💼 시니어 개발자 분석

| 항목               | 위험 여부 | 설명                                               |
| ------------------ | --------- | -------------------------------------------------- |
| 이벤트 리스너 충돌 | 🟢 낮음   | 신규 버튼에 독립적 onClick 핸들러 - 기존 영향 없음 |
| 전역 상태 공유     | 🟡 중간   | 피드백 API 확장 시 response 구조 변경 주의         |
| API 호출 충돌      | 🟢 낮음   | 새 엔드포인트 `/api/raft/dataset` 분리 권장        |

### 👨‍💻 주니어 개발자 보완

> "피드백 API에 'RAFT 변환' 로직을 넣으면 기존 피드백 저장 로직과 트랜잭션 충돌 가능성이 있습니다. 별도 API로 분리하는 게 안전합니다."

### 🎨 UX/UI 전문가 의견

> "한 번 클릭으로 피드백 → RAFT 변환이 되면 실수할 수 있습니다. 확인 모달 또는 되돌리기 기능 필요."

---

## 3️⃣ 데이터 간섭 분석

### 🧑‍💼 시니어 개발자 분석

| 항목                  | 위험 여부 | 설명                                         |
| --------------------- | --------- | -------------------------------------------- |
| 같은 데이터 동시 수정 | 🟡 중간   | 피드백 테이블과 RAFT 테이블 간 FK 관계 필요  |
| 비동기 충돌           | 🟢 낮음   | RAFT 저장은 별도 테이블 - 피드백 수정과 독립 |
| 데이터 정합성         | 🔴 높음   | 피드백 삭제 시 RAFT 데이터 orphan 가능성     |

### 👨‍💻 주니어 개발자 보완

> "hallucination_feedback 테이블에서 피드백을 삭제하면, 해당 피드백을 참조하는 RAFT 데이터가 고아가 됩니다. FK에 ON DELETE SET NULL 또는 CASCADE 설정 필요."

### 🎨 UX/UI 전문가 의견

> "사용자가 피드백을 삭제할 때 'RAFT 데이터로 저장됨'이면 경고를 표시해야 합니다."

---

## 🗳️ 토론 및 투표

### 발견된 문제점 우선순위

| 순위 | 문제                            | 심각도  | 시니어 | 주니어 | UX     |
| ---- | ------------------------------- | ------- | ------ | ------ | ------ |
| 1    | 피드백 삭제 시 RAFT 데이터 고아 | 🔴 높음 | ⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐   |
| 2    | 피드백 API 응답 구조 변경 주의  | 🟡 중간 | ⭐⭐⭐ | ⭐⭐   | ⭐     |
| 3    | 큐레이션 모달 z-index 충돌      | 🟡 중간 | ⭐⭐   | ⭐⭐   | ⭐⭐⭐ |
| 4    | 큐레이션 실수 방지 UI           | 🟡 중간 | ⭐     | ⭐⭐   | ⭐⭐⭐ |
| 5    | FeedbackCard 버튼 정렬          | 🟢 낮음 | ⭐     | ⭐⭐   | ⭐⭐   |

---

## ✅ 권장 조치 사항

### 🔴 높음 (즉시 해결)

1. **RAFT 데이터셋 테이블에 FK 설계**
   - `feedback_id` → `hallucination_feedback(id)`
   - `ON DELETE SET NULL` 설정 (데이터 보존)
   - 또는 독립 테이블로 복사 저장 (참조 없이)

### 🟡 중간 (구현 시 주의)

2. **RAFT API 분리**

   - 기존: `/api/feedback/hallucination` (피드백 저장)
   - 신규: `/api/raft/dataset` (RAFT 데이터 관리)
   - 신규: `/api/raft/generate` (합성 데이터 생성)

3. **큐레이션 모달 z-index**

   - 기존 모달보다 높은 z-index 사용 (z-50 이상)
   - 배경 overlay 추가

4. **확인 UI 추가**
   - RAFT 저장 전 확인 모달
   - "RAFT에 저장됨" 배지 표시
   - 저장 취소 기능

### 🟢 낮음 (개선 권장)

5. **FeedbackCard 레이아웃 확인**
   - 버튼 추가 후 flex 정렬 테스트
   - 모바일 반응형 확인

---

## 📋 체크리스트 준비 항목

### Phase 4-A: 데이터베이스 (DB)

- [ ] `039_raft_dataset.sql` 마이그레이션 작성
  - [ ] raft_dataset 테이블 스키마 정의
  - [ ] FK 관계 설정 (ON DELETE SET NULL)
  - [ ] RLS 정책 설정 (service_role only)
  - [ ] 인덱스 추가 (source, verified)

### Phase 4-B: API 엔드포인트

- [ ] `/api/raft/dataset` 생성

  - [ ] GET: RAFT 데이터 목록 조회
  - [ ] POST: 피드백 → RAFT 변환 저장
  - [ ] DELETE: RAFT 데이터 삭제

- [ ] `/api/raft/generate` 생성
  - [ ] POST: LLM 합성 데이터 생성
  - [ ] 배치 생성 지원 (최대 50개/요청)

### Phase 4-C: UI 컴포넌트

- [ ] `FeedbackCard` 확장

  - [ ] "RAFT 저장" 버튼 추가
  - [ ] "RAFT 저장됨" 배지 표시
  - [ ] 확인 모달 구현

- [ ] `app/admin/raft` 페이지 생성
  - [ ] RAFT 데이터셋 목록 조회
  - [ ] 합성 데이터 생성 UI
  - [ ] 데이터셋 내보내기 (JSON)

### Phase 4-D: 합성 데이터 생성

- [ ] `syntheticDataGenerator.ts` 모듈 생성
  - [ ] LLM 프롬프트 템플릿 정의
  - [ ] 참고 자료 기반 Q&A 생성
  - [ ] 품질 검증 로직 (길이, 형식)

---

## 🎯 결론

### 최종 합의

1. **RAFT 테이블은 독립적으로 설계** (피드백 참조 없이 복사 저장)
   → 피드백 삭제 영향 차단

2. **API는 `/api/raft/` 경로로 완전 분리**
   → 기존 피드백 API 영향 없음

3. **UI는 확인 모달 + 배지로 실수 방지**
   → UX 안전성 확보

---

> **다음 단계**: 디렉터님 승인 후 체크리스트 실행 진행
