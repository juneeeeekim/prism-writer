# PRISM Phase 2–4 고도화 회의 정리 (문제 예상 → 개선 과제만)
> 목적: 지금까지 논의에서 **문제가 예상되는 지점만** 추려서, **Phase 2–4에서 점점 고도화해야 할 과제**만 정리한다.  
> 형식: “예상 문제(리스크) → 개선 목표 → 실행 과제(Owner)” 중심.

---

## 1) Phase 2 — 안정화(Reliability) & 성능 기본기
### 1.1 인제스트 병목/실패(가장 흔한 장애)
- **예상 문제**
  - PDF/긴 문서에서 파싱 실패·지연 발생 → “업로드는 됐는데 검색이 안 됨”
  - 동일 문서 재업로드/재처리로 중복 청크 증가 → 비용/성능 악화
- **개선 목표**
  - 인제스트를 “재현 가능하고, 재시도 가능하고, 관측 가능”하게 만든다.
- **실행 과제 (Owner)**
  - **Backend/DevOps**: `ingestion_jobs` 상태머신(queued/running/failed/done) + 재시도 정책(최대 N회) + 타임아웃/취소
  - **DB**: 청크 해시 기반 중복 제거(문서+chunk_index+hash) / 인제스트 로그 테이블
  - **AI/ML**: 청킹 규칙(길이+문단/헤더) 표준화 + 실패 케이스 샘플링
  - **Frontend**: “인제스트 상태/실패 사유/재시도 버튼” UX

---

### 1.2 검색 품질 흔들림(튜닝 없이 들쑥날쑥)
- **예상 문제**
  - 벡터 TopK만으로는 “관련 없는 청크”가 섞임 → 환각/부정확 답변
  - 필터/가중치 없이 Hybrid 도입 시 결과가 불안정
- **개선 목표**
  - Hybrid 검색을 **로그 기반으로** 튜닝할 수 있게 만든다.
- **실행 과제 (Owner)**
  - **DB/Backend**: 검색 로그(쿼리, topK, 필터, latency, 결과 ID) 수집
  - **AI/ML**: 간단 리랭킹(저비용) 도입 옵션, 컨텍스트 구성 규칙(중복 제거/길이 제한)
  - **Backend**: 검색 API에 `filters`, `top_k`, `mode(cheap/standard)` 옵션 추가
  - **Frontend**: “근거 카드”에서 사용자 피드백(유용/무관) 수집(품질 튜닝 신호)

---

### 1.3 비용/응답 속도 폭주(운영 리스크)
- **예상 문제**
  - 긴 질문/큰 TopK/긴 컨텍스트 → 토큰 비용 급증 + p95 지연 상승
- **개선 목표**
  - 비용 상한과 저비용 모드로 “폭주를 제어”한다.
- **실행 과제 (Owner)**
  - **Backend**: 사용자별 일/월 상한(soft/hard), 레이트리밋
  - **AI/ML**: 저비용 모드(컨텍스트 축소, 모델 다운시프트, 요약 후 답변)
  - **DevOps**: 비용/토큰/latency 대시보드, 경보(알람)

---

### 1.4 품질 회귀(프롬프트/모델 변경 시 망가짐)
- **예상 문제**
  - 모델/프롬프트/청킹 변경 후 품질 하락을 “배포 후에야” 알게 됨
- **개선 목표**
  - 최소 평가셋 + 회귀 테스트로 품질을 “측정 가능한 상태”로 유지
- **실행 과제 (Owner)**
  - **AI/ML**: 평가셋(20~50문항) + 지표(근거 인용률/정답성 샘플링/환각률)
  - **DevOps**: CI에 회귀 평가(간단 버전) 붙여서 기준선 대비 하락 감지
  - **Backend**: 답변 로그에 prompt_version / model_version 기록

---

## 2) Phase 3 — 보안(Security) & 운영체계(Operations)
### 2.1 멀티테넌시/개인 문서 노출 리스크
- **예상 문제**
  - RLS/인가가 약하면 “타인 문서 접근” 같은 치명 사고 가능
- **개선 목표**
  - Auth/RBAC + DB RLS로 접근을 강제하고, 감사로그로 추적 가능하게
- **실행 과제 (Owner)**
  - **Security/DB**: RLS 정책 확정(문서/청크/로그 전부), 최소 권한 원칙
  - **Backend**: 권한 체크 미들웨어 표준화(엔드포인트 공통)
  - **Security**: 감사로그(audit_logs) 설계(누가/언제/무엇을/왜)

---

### 2.2 파일 업로드 공격면(악성 파일/메타데이터/우회)
- **예상 문제**
  - MIME 위장, 대용량 업로드, 악성 콘텐츠 업로드, 메타데이터 유출
- **개선 목표**
  - 업로드 검증을 “정책+코드”로 고정하고 운영 루틴화
- **실행 과제 (Owner)**
  - **Security/Backend**: 시그니처 기반 MIME 확인, 크기 제한, 해시, (가능 시) 스캔, 메타데이터 제거
  - **DevOps**: 의존성/취약점 스캔 루틴(주 1회), 간단 보안 점검 체크리스트(월 1회)

---

### 2.3 데이터 손실/복구 불가 리스크
- **예상 문제**
  - 실수/버그/운영 장애로 데이터 손실 → 복구 절차가 없으면 장기 다운
- **개선 목표**
  - 백업 자동화 + 복구 리허설로 “복구 가능성”을 보장
- **실행 과제 (Owner)**
  - **DevOps/DB**: 백업 정책(주기/보존/암호화), 복구 리허설(월 1회)
  - **Backend**: 소프트 삭제/아카이빙 정책(원문/청크/로그 분리)

---

## 3) Phase 4 — 제품 완성도(Product Polish) & 멀티모달 고도화
### 3.1 사용자 신뢰(근거 UX 부족 시 전환 저하)
- **예상 문제**
  - 답변만 보여주면 “왜 맞는지”가 약해 신뢰/전환이 떨어짐
- **개선 목표**
  - 근거를 “읽기 쉬운 형태”로 제공하고, 실패 UX를 제품 수준으로
- **실행 과제 (Owner)**
  - **Frontend**: 근거 카드(문서/페이지/청크), 하이라이트, “근거로 이동”
  - **Frontend/Backend**: 실패 UX(인제스트 실패/권한 없음/비용 초과/타임아웃) 표준 문구+대안(재시도/저비용 모드)

---

### 3.2 멀티모달 정확도(이미지/PDF 구조 이해 한계)
- **예상 문제**
  - “이미지 캡션”만으로는 표/레이아웃/도표 의미가 누락될 수 있음
- **개선 목표**
  - 멀티모달을 단계적으로 고도화(레이아웃/표 추출/구조화)
- **실행 과제 (Owner)**
  - **AI/ML**: PDF 레이아웃 기반 청킹, 표/헤더 구조화, 이미지-텍스트 정합성 점검
  - **Backend**: 멀티모달 파서 Strategy 확장(타입별 파서 플러그인)

---

### 3.3 운영/개발 생산성(기능 늘수록 복잡도 폭발)
- **예상 문제**
  - 기능 확장과 함께 디버깅/릴리즈가 느려짐
- **개선 목표**
  - “규격/자동화/표준화”로 팀 속도를 유지
- **실행 과제 (Owner)**
  - **Architect**: 경계/규칙(UseCase 단위, DTO/Entity 분리, 의존성 방향) 문서화 고정
  - **DevOps**: 배포 자동화(롤백 포함), 관측 표준(RED/USE), 에러 규격 통일
  - **Backend**: 공통 모듈화(에러/로깅/권한/요청 검증)

---

## 4) 역할별 “핵심 담당” 요약
- **Architect**: 경계/규칙/로드맵 유지, 복잡도 통제(단계적 도입)
- **Backend**: 잡/재시도/레이트리밋/에러규격/비용상한
- **DB**: 스키마 분리, 인덱스, 로그 테이블, 백업/복구
- **AI/ML**: 청킹/리랭킹/평가셋/멀티모달 고도화
- **DevOps**: CI/CD, 모니터링/알람, 복구 리허설, 보안 스캔 루틴
- **Frontend**: 근거 UX, 실패 UX, 사용자 피드백 수집
- **Security**: Auth/RLS, 업로드 보안 정책, 감사로그, 점검 루틴

---

## 5) 다음 회의에서 “결정해야 하는 7가지”(결정 포인트)
1) 인제스트 잡 상태/재시도 규칙(타임아웃, 최대 재시도, 실패 분류)  
2) 검색 모드(cheap/standard)와 topK 기본값  
3) 비용 상한(soft/hard)과 초과 시 UX  
4) 평가셋 구성 방식(도메인 질문 분포)과 지표 정의  
5) RLS 정책 범위(문서/청크/로그 전부)  
6) 백업/보존/아카이빙 정책(원문 vs 청크 vs 로그)  
7) 근거 UI의 “필수 요소”(페이지/청크/하이라이트/원문 이동)
