# JeDebug Review: Phase 15 Document-Scoped Evaluations Checklist

**ê²€í† ì¼**: 2025-12-28 05:50  
**ê²€í† ì**: JeDebug (Senior Lead Developer)  
**ê²€í†  ëŒ€ìƒ**: `2512280547_Phase15_Document_Evaluations_Checklist.md`

---

## 1. ğŸ”§ ë¡œì§ ë° êµ¬í˜„ ë³´ì™„ (Logic Fixes)

### Critical Issues

- [x] **(Critical) `documentId` í•„ë“œ ì ‘ê·¼ ê²€ì¦ ì™„ë£Œ**

  - [x] ì›ì¸: ì²´í¬ë¦¬ìŠ¤íŠ¸ì— "[í™•ì¸ í•„ìš”] useEditorStateì—ì„œ documentId í•„ë“œ ë…¸ì¶œ ì—¬ë¶€" ëª…ì‹œë¨
  - [x] **ê²€ì¦ ê²°ê³¼**: `useEditorState.ts` line 36ì— `documentId: string | null` ì¡´ì¬ âœ…
  - [x] **ìƒíƒœ**: ë¬¸ì œ ì—†ìŒ - ì¦‰ì‹œ êµ¬í˜„ ê°€ëŠ¥

- [ ] **(Critical) `SavedEvaluation` íƒ€ì…ì— `document_id` í•„ë“œ ëˆ„ë½**
  - [ ] ì›ì¸: ì²´í¬ë¦¬ìŠ¤íŠ¸ P15-03-02ì—ì„œ API ì‘ë‹µì„ `SavedEvaluation[]`ë¡œ ë§¤í•‘í•˜ë‚˜, íƒ€ì…ì— `document_id` ë¯¸í¬í•¨
  - [ ] **ìˆ˜ì • ì œì•ˆ**: P15-03 ì‹œì‘ ì „ `SavedEvaluation` ì¸í„°í˜ì´ìŠ¤ì— `document_id?: string` ì¶”ê°€
  - [ ] íŒŒì¼/ìœ„ì¹˜: `EvaluationTab.tsx` line 62-67

```typescript
// Before
interface SavedEvaluation {
  id: string;
  result_data: V5EvaluationResult;
  overall_score: number;
  created_at: string;
}

// After
interface SavedEvaluation {
  id: string;
  document_id?: string; // Phase 15 ì¶”ê°€
  result_data: V5EvaluationResult;
  overall_score: number;
  created_at: string;
}
```

### Major Issues

- [ ] **(Major) useEffect ì˜ì¡´ì„± ë°°ì—´ ì˜¤ë¥˜ ê°€ëŠ¥ì„±**

  - [ ] ì›ì¸: P15-03-02ì—ì„œ `useEffect` ì˜ì¡´ì„±ì— `documentId` ì¶”ê°€ ì‹œ, `loadEvaluations` í•¨ìˆ˜ê°€ ì™¸ë¶€ ì •ì˜ë˜ì–´ ìˆìœ¼ë©´ ESLint ê²½ê³  ë°œìƒ ê°€ëŠ¥
  - [ ] **ìˆ˜ì • ì œì•ˆ**: `loadEvaluations`ë¥¼ `useEffect` ë‚´ë¶€ì— ì •ì˜í•˜ê±°ë‚˜, `useCallback`ìœ¼ë¡œ ê°ì‹¸ì•¼ í•¨
  - [ ] íŒŒì¼/ìœ„ì¹˜: `EvaluationTab.tsx` line 90-115 (í˜„ì¬ ì´ë¯¸ ë‚´ë¶€ ì •ì˜ë˜ì–´ ìˆìŒ âœ…)

- [ ] **(Major) ìƒˆ ë¬¸ì„œ ìƒì„± ì‹œ documentIdê°€ nullì¸ ì¼€ì´ìŠ¤ ì²˜ë¦¬**
  - [ ] ì›ì¸: ìƒˆ ë¬¸ì„œ(ë¯¸ì €ì¥)ì—ì„œ í‰ê°€ ì‹¤í–‰ ì‹œ `documentId = null`, APIì—ì„œ ì •ìƒ ì²˜ë¦¬ í•„ìš”
  - [ ] **ìˆ˜ì • ì œì•ˆ**: P15-02-01, P15-02-02ì— `documentIdê°€ nullì¸ ê²½ìš°` ì¡°ê±´ ëª…ì‹œ ì¶”ê°€
  - [ ] íŒŒì¼/ìœ„ì¹˜: `evaluations/route.ts` GET/POST í•¸ë“¤ëŸ¬

```typescript
// GET: documentIdê°€ nullì´ë©´ ì „ì²´ ì¡°íšŒ (ê¸°ì¡´ ë™ì‘ ìœ ì§€)
const documentId = searchParams.get("documentId");
if (documentId && documentId !== "null") {
  query = query.eq("document_id", documentId);
}
// 'null' ë¬¸ìì—´ ì²´í¬ í•„ìš” (ì¿¼ë¦¬ìŠ¤íŠ¸ë§ì—ì„œ nullì´ ë¬¸ìì—´ë¡œ ì „ë‹¬ë  ìˆ˜ ìˆìŒ)
```

---

## 2. ğŸš¨ ë¦¬ìŠ¤í¬ ë° ì•ˆì „ì¥ì¹˜ (Risk Guardrails)

### High Risk

- [ ] **(High) í‰ê°€ ì‚­ì œ ì‹œ confirmDialog ì—†ì´ ì¦‰ì‹œ ì‚­ì œ ìœ„í—˜**
  - [ ] ìœ„í—˜ ìš”ì†Œ: P15-03-04ì— `confirm()` í˜¸ì¶œì´ ëª…ì‹œë˜ì–´ ìˆìœ¼ë‚˜, ë¸Œë¼ìš°ì € ê¸°ë³¸ `confirm()`ì€ ëª¨ë°”ì¼ì—ì„œ ë¹„í‘œì¤€ì  ë™ì‘
  - [ ] **ë°©ì–´ ì½”ë“œ ì¶”ê°€ ì œì•ˆ**: ì»¤ìŠ¤í…€ Modal ì»´í¬ë„ŒíŠ¸ ì‚¬ìš© ê¶Œì¥, ë˜ëŠ” ìµœì†Œí•œ `confirm()` ë°˜í™˜ê°’ ì²´í¬ í•„ìˆ˜

```typescript
const handleDeleteEvaluation = async (id: string) => {
  const confirmed = window.confirm("ì´ í‰ê°€ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
  if (!confirmed) return; // ì´ ì²´í¬ ë°˜ë“œì‹œ í•„ìš”
  // ...
};
```

- [ ] **(High) CASCADE ì‚­ì œë¡œ ì¸í•œ ì˜ë„ì¹˜ ì•Šì€ ë°ì´í„° ì†ì‹¤**
  - [ ] ìœ„í—˜ ìš”ì†Œ: `ON DELETE CASCADE` ì„¤ì •ìœ¼ë¡œ ë¬¸ì„œ ì‚­ì œ ì‹œ ëª¨ë“  í‰ê°€ ìë™ ì‚­ì œ
  - [ ] **ë°©ì–´ ë¡œì§ ì œì•ˆ**: ë¬¸ì„œ ì‚­ì œ ì „ ì‚¬ìš©ìì—ê²Œ "ì—°ê²°ëœ Nê°œì˜ í‰ê°€ë„ í•¨ê»˜ ì‚­ì œë©ë‹ˆë‹¤" ê²½ê³  í‘œì‹œ ê¶Œì¥
  - [ ] **ì²´í¬ë¦¬ìŠ¤íŠ¸ ìˆ˜ì •**: E2E-04 í…ŒìŠ¤íŠ¸ ì „ ì‚¬ìš©ì ê²½ê³  UI êµ¬í˜„ ì—¬ë¶€ ê²°ì • í•„ìš” [í™•ì¸ í•„ìš”: ë””ë ‰í„°ë‹˜]

### Mid Risk

- [ ] **(Mid) ëŒ€ëŸ‰ í‰ê°€ íˆìŠ¤í† ë¦¬ ì‹œ ì„±ëŠ¥ ì €í•˜**

  - [ ] ìœ„í—˜ ìš”ì†Œ: ë¬¸ì„œë‹¹ ìˆ˜ì‹­ ê°œì˜ í‰ê°€ê°€ ëˆ„ì ë  ê²½ìš° ë¡œë”© ì§€ì—°
  - [ ] **ë°©ì–´ ë¡œì§ ì œì•ˆ**: APIì—ì„œ `limit=10` í•˜ë“œì½”ë”©ë˜ì–´ ìˆìœ¼ë‚˜, í˜ì´ì§€ë„¤ì´ì…˜ UI ì¶”ê°€ ê³ ë ¤
  - [ ] **í˜„ì¬ ìƒíƒœ**: limit ì ìš©ë¨, ë‹¹ì¥ì€ ë¬¸ì œ ì—†ìŒ âœ…

- [ ] **(Mid) ë™ì‹œ ë¬¸ì„œ ì „í™˜ ì‹œ Race Condition**
  - [ ] ìœ„í—˜ ìš”ì†Œ: ë¹ ë¥¸ ë¬¸ì„œ ì „í™˜ ì‹œ ì´ì „ ìš”ì²­ì´ ëŠ¦ê²Œ ë„ì°©í•˜ì—¬ ì˜ëª»ëœ ë°ì´í„° í‘œì‹œ
  - [ ] **ë°©ì–´ ë¡œì§ ì œì•ˆ**: AbortController ì‚¬ìš© ë˜ëŠ” ìš”ì²­ ID ë¹„êµ ë¡œì§ ì¶”ê°€

```typescript
useEffect(() => {
  let cancelled = false;
  const loadEvaluations = async () => {
    // ...
    if (!cancelled) {
      setSavedEvaluations(data.evaluations);
    }
  };
  loadEvaluations();
  return () => {
    cancelled = true;
  };
}, [documentId]);
```

---

## 3. ğŸ§ª ê²€ì¦ ê¸°ì¤€ êµ¬ì²´í™” (Test Criteria)

### Happy Path í…ŒìŠ¤íŠ¸ ê¸°ì¤€

- [ ] **HP-01**: ë¬¸ì„œ A ë¡œë“œ â†’ í‰ê°€ íƒ­ í´ë¦­ â†’ ë¬¸ì„œ Aì˜ í‰ê°€ë§Œ í‘œì‹œë¨

  - Expected: `savedEvaluations` ë°°ì—´ì˜ ëª¨ë“  í•­ëª©ì´ `document_id === A`

- [ ] **HP-02**: í‰ê°€ ì‹¤í–‰ â†’ ì €ì¥ ì„±ê³µ â†’ íˆìŠ¤í† ë¦¬ì— ì¦‰ì‹œ ë°˜ì˜

  - Expected: `setSavedEvaluations`ê°€ ìƒˆ í‰ê°€ë¥¼ í¬í•¨í•˜ì—¬ ì—…ë°ì´íŠ¸

- [ ] **HP-03**: ì‚­ì œ ë²„íŠ¼ í´ë¦­ â†’ í™•ì¸ â†’ ëª©ë¡ì—ì„œ ì œê±°
  - Expected: ì‚­ì œëœ í‰ê°€ IDê°€ `savedEvaluations`ì—ì„œ í•„í„°ë§ë¨

### Edge Case í…ŒìŠ¤íŠ¸ ê¸°ì¤€

- [ ] **EC-01**: ìƒˆ ë¬¸ì„œ(ì €ì¥ ì•ˆ ë¨, documentId = null)ì—ì„œ í‰ê°€ ì‹¤í–‰

  - Expected: í‰ê°€ê°€ `document_id = null`ë¡œ ì €ì¥ë¨, ì˜¤ë¥˜ ì—†ìŒ

- [ ] **EC-02**: ë¬¸ì„œ A â†’ ë¬¸ì„œ B â†’ ë¬¸ì„œ A ë¹ ë¥´ê²Œ ì „í™˜ (Race Condition)

  - Expected: ìµœì¢…ì ìœ¼ë¡œ ë¬¸ì„œ Aì˜ í‰ê°€ë§Œ í‘œì‹œ, Bì˜ í‰ê°€ í˜¼ì… ì•ˆ ë¨

- [ ] **EC-03**: í‰ê°€ 0ê°œì¸ ë¬¸ì„œ ë¡œë“œ

  - Expected: "ì´ ë¬¸ì„œì˜ í‰ê°€ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤" ë©”ì‹œì§€ í‘œì‹œ

- [ ] **EC-04**: ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ì‹œ ì‚­ì œ ì‹¤íŒ¨
  - Expected: ì—ëŸ¬ Toast í‘œì‹œ, ëª©ë¡ ìƒíƒœ ìœ ì§€ (ë¡¤ë°±)

---

## 4. ìµœì¢… íŒë‹¨ (Decision)

- [x] **ìƒíƒœ**: âš ï¸ ì²´í¬ë¦¬ìŠ¤íŠ¸ ìˆ˜ì • í›„ ì§„í–‰

### í•„ìˆ˜ ìˆ˜ì • ì‚¬í•­ (êµ¬í˜„ ì „ ë°˜ì˜ í•„ìš”)

| ìš°ì„ ìˆœìœ„    | í•­ëª©                   | ìˆ˜ì • ìœ„ì¹˜           | ìˆ˜ì • ë‚´ìš©                                    |
| ----------- | ---------------------- | ------------------- | -------------------------------------------- |
| ğŸ”´ Critical | `SavedEvaluation` íƒ€ì… | P15-03 Before Start | `document_id?: string` í•„ë“œ ì¶”ê°€             |
| ğŸŸ  Major    | `documentId` null ì²´í¬ | P15-02-01 Detail    | `documentId !== 'null'` ì¡°ê±´ ì¶”ê°€            |
| ğŸŸ¡ Mid      | Race Condition ë°©ì§€    | P15-03-02 Detail    | `cancelled` í”Œë˜ê·¸ ë˜ëŠ” AbortController ì¶”ê°€ |

### ê°€ì¥ ì¹˜ëª…ì ì¸ ê²°í•¨ 1ì¤„ ìš”ì•½

> **`SavedEvaluation` íƒ€ì…ì— `document_id` í•„ë“œê°€ ì—†ì–´ TypeScript ì»´íŒŒì¼ ì—ëŸ¬ ë°œìƒ ì˜ˆìƒ**

---

## 5. ìˆ˜ì •ëœ ì²´í¬ë¦¬ìŠ¤íŠ¸ í•­ëª© (Amended Items)

### P15-03 Before Start (ìˆ˜ì •)

**ì˜í–¥ë°›ëŠ” ê¸°ì¡´ íŒŒì¼/í•¨ìˆ˜**:

- íŒŒì¼: `frontend/src/components/Assistant/EvaluationTab.tsx`
- **íƒ€ì…**: `SavedEvaluation` ì¸í„°í˜ì´ìŠ¤ (line 62-67) â† **ì¶”ê°€**
- í•¨ìˆ˜: `loadEvaluations()` (line 91-113), `saveEvaluation()` (line 120-138)

### P15-03-00 (ì‹ ê·œ í•­ëª© ì¶”ê°€)

- [ ] **P15-03-00**: `SavedEvaluation` íƒ€ì…ì— `document_id` í•„ë“œ ì¶”ê°€
  - `Target`: `EvaluationTab.tsx` â†’ line 62-67
  - `Detail`: `document_id?: string` ì¶”ê°€
  - `Dependency`: P15-01-01
  - `Quality`: Optional íƒ€ì…ìœ¼ë¡œ ê¸°ì¡´ ë°ì´í„° í˜¸í™˜ì„± ìœ ì§€

### P15-03-02 (ìˆ˜ì •)

- [ ] **P15-03-02**: `loadEvaluations` ë¬¸ì„œë³„ í•„í„°ë§ + Race Condition ë°©ì§€
  - `Target`: `EvaluationTab.tsx` â†’ `loadEvaluations()` í•¨ìˆ˜ (line 91-113)
  - `Detail`:
    1. URL ìƒì„±: `documentId ? \`/api/evaluations?documentId=${documentId}&limit=10\` : '/api/evaluations?limit=5'`
    2. **`let cancelled = false` í”Œë˜ê·¸ ì¶”ê°€** â† ì¶”ê°€
    3. **fetch í›„ `if (!cancelled)` ì²´í¬** â† ì¶”ê°€
    4. **cleanup í•¨ìˆ˜ì—ì„œ `cancelled = true` ì„¤ì •** â† ì¶”ê°€
    5. `useEffect` ì˜ì¡´ì„± ë°°ì—´ì— `documentId` ì¶”ê°€
  - `Dependency`: P15-02-01, P15-03-01
  - `Quality`: Race Condition ë°©ì§€

### P15-02-01 (ë³´ì™„)

- [ ] **P15-02-01**: GET API - `documentId` í•„í„° ì¶”ê°€ (null ì²˜ë¦¬ ë³´ì™„)
  - `Target`: `evaluations/route.ts` â†’ `GET()` í•¨ìˆ˜ (ê¸°ì¡´)
  - `Detail`:
    1. `const documentId = searchParams.get('documentId')`
    2. **`if (documentId && documentId !== 'null') { query = query.eq('document_id', documentId) }`** â† ìˆ˜ì •
  - `Dependency`: P15-01-01
  - `Quality`: 'null' ë¬¸ìì—´ ì „ë‹¬ ì‹œ ì „ì²´ ì¡°íšŒë¡œ fallback
