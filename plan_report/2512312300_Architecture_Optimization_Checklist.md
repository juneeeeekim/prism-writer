# ğŸš€ Phase 7: ì•„í‚¤í…ì²˜ ì•ˆì •í™” ë° ì„±ëŠ¥ ìµœì í™” - êµ¬í˜„ ì§€ì‹œì„œ

**ì‘ì„±ì¼**: 2025-12-31 23:00  
**ì‘ì„±ì**: Tech Lead (15ë…„ì°¨)  
**ë¬¸ì„œ ID**: PHASE7-OPTIMIZATION-2025-1231  
**ê´€ë ¨ ë¬¸ì„œ**: [2512312250_Phase5_6_Deployment_Walkthrough.md](./2512312250_Phase5_6_Deployment_Walkthrough.md)

---

## ğŸ“Œ Executive Summary

Phase 5, 6 ë°°í¬ ì™„ë£Œ í›„ ì‹ë³„ëœ ì•„í‚¤í…ì²˜ì˜ ë¶ˆì•ˆì • ìš”ì†Œ(406/500 ì—ëŸ¬)ë¥¼ ì œê³ í•˜ê³ , ì‚¬ìš©ì ê²½í—˜ì˜ í•µì‹¬ì¸ ì„±ëŠ¥(TTFT)ì„ ìµœì í™”í•˜ëŠ” ë‹¨ê³„ì…ë‹ˆë‹¤. ë©€í‹° í”„ë¡œì íŠ¸ í™˜ê²½ì—ì„œì˜ ë°ì´í„° ì •ë°€ë„ì™€ ì‹œìŠ¤í…œ ë³µì›ë ¥ì„ ê°•í™”í•˜ëŠ” ë° ì§‘ì¤‘í•©ë‹ˆë‹¤.

---

## [Phase 7.1: Critical ì—ëŸ¬ í•´ê²° ë° ì•ˆì •í™”]

**Before Start:**

- âš ï¸ ì£¼ì˜: `supabase-js` ë²„ì „ ë° HTTP í—¤ë” ì„¤ì •ì€ ê¸€ë¡œë²Œí•˜ê²Œ ì˜í–¥ì„ ì£¼ë¯€ë¡œ ê³µí†µ ì„¤ì • íŒŒì¼(`lib/supabase.ts`) ìˆ˜ì • ì‹œ ì‹ ì¤‘íˆ ì§„í–‰í•˜ì‹­ì‹œì˜¤.
- âš ï¸ ë ˆê±°ì‹œ: ê¸°ì¡´ `rpc` í•¨ìˆ˜ í˜¸ì¶œ ì‹œ ì „ë‹¬ë˜ëŠ” íŒŒë¼ë¯¸í„° íƒ€ì…ì´ ì¼ì¹˜í•˜ëŠ”ì§€ ìš°ì„  í™•ì¸í•˜ì‹­ì‹œì˜¤.

**Implementation Items:**

- [x] **ID(P7-01)**: **Supabase 406 (Not Acceptable) ì—ëŸ¬ í•´ê²°** âœ… COMPLETED (2025-12-31 23:15)

  - `Target`: `frontend/src/lib/supabase/client.ts` > `createClient()`
  - `êµ¬í˜„ ë‚´ìš©`:
    - `clientOptions` ê°ì²´ë¡œ ì„¤ì • ë¶„ë¦¬
    - `db: { schema: 'public' as const }` ì¶”ê°€
    - `global.headers`ì— `Accept`, `Accept-Profile`, `Content-Profile` í—¤ë” ì¶”ê°€
    - placeholder í´ë¼ì´ì–¸íŠ¸ì™€ ì‹¤ì œ í´ë¼ì´ì–¸íŠ¸ ëª¨ë‘ì— ì˜µì…˜ ì ìš©
  - TypeScript ì»´íŒŒì¼: ì˜¤ë¥˜ 0ê°œ

- [x] **ID(P7-02)**: **Vector Search 500 ì—ëŸ¬ ì¡°ì‚¬ ë° ë³µì›ë ¥ ê°•í™”** âœ… COMPLETED (2025-12-31 23:20)
  - `Target`: `frontend/src/lib/rag/search.ts` > `vectorSearch()`
  - `êµ¬í˜„ ë‚´ìš©`:
    - `withRetry<T>()` ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ì¶”ê°€ (Exponential Backoff: 200ms â†’ 400ms â†’ 800ms)
    - `MAX_RETRY_COUNT = 3`, `INITIAL_BACKOFF_MS = 200`, `EMBEDDING_DIMENSION = 1536` ìƒìˆ˜ ì •ì˜
    - `embedText` í˜¸ì¶œì— withRetry ì ìš© + ì°¨ì› ê²€ì¦ (1536)
    - v3 RPC (`match_document_chunks`) í˜¸ì¶œì— withRetry + Graceful Degradation ì ìš©
    - v4 RPC (`search_similar_chunks_v2`) í˜¸ì¶œì— withRetry + Graceful Degradation ì ìš©
    - Fallback RPC (`search_similar_chunks`) í˜¸ì¶œì— withRetry + Graceful Degradation ì ìš©
    - ëª¨ë“  ì‹¤íŒ¨ ì‹œ ë¹ˆ ë°°ì—´ `[]` ë°˜í™˜ìœ¼ë¡œ 500 ì—ëŸ¬ ë°©ì§€
  - TypeScript ì»´íŒŒì¼: ì˜¤ë¥˜ 0ê°œ (9ê°œ â†’ 0ê°œ ìˆ˜ì • ì™„ë£Œ)

---

## [Phase 7.2: ì„±ëŠ¥ ìµœì í™” (Chat TTFT ê°œì„ )]

**Before Start:**

- âš ï¸ ì£¼ì˜: ìŠ¤íŠ¸ë¦¬ë° ì‘ë‹µ ë„ì¤‘ ì—°ê²°ì´ ëŠê¸°ëŠ” ê²½ìš°(`onClose`) ë¦¬ì†ŒìŠ¤ ì •ë¦¬ë¥¼ ë°˜ë“œì‹œ ìˆ˜í–‰í•´ì•¼ í•©ë‹ˆë‹¤.

**Implementation Items:**

- [x] **ID(P7-03)**: **ì±„íŒ… TTFT (Time To First Token) 2ì´ˆ ì´ë‚´ ë‹¨ì¶•** âœ… COMPLETED (2025-12-31 23:30)
  - `Target`: `frontend/src/app/api/chat/route.ts` > `POST()`
  - `êµ¬í˜„ ë‚´ìš©`:
    - `performance.now()` ê¸°ë°˜ ì„±ëŠ¥ ì¸¡ì • ì‹œì‘ì  ì¶”ê°€
    - `memoryPromise`, `templatePromise`, `ragPromise` 3ê°œì˜ Promiseë¡œ ë¶„ë¦¬
    - `Promise.all([memory, template, rag])` ë³‘ë ¬ ì‹¤í–‰ìœ¼ë¡œ ëŒ€ê¸° ì‹œê°„ ìµœì†Œí™”
    - ë³‘ë ¬ ì²˜ë¦¬ ì™„ë£Œ ì‹œê°„ ë¡œê¹…: `[Chat API] Parallel fetch completed in XXms`
    - ì²« í† í° ìˆ˜ì‹  ì‹œ TTFT ë¡œê¹…: `[Chat API] TTFT: XXms (target: <2000ms)`
    - ê° Promiseì— ê°œë³„ catch ë¸”ë¡ìœ¼ë¡œ ë‹¨ì¼ ì‹¤íŒ¨ê°€ ì „ì²´ì— ì˜í–¥ ì£¼ì§€ ì•Šë„ë¡ ì²˜ë¦¬
  - TypeScript ì»´íŒŒì¼: ì˜¤ë¥˜ 0ê°œ

---

## [Phase 7.3: í”„ë¡œì íŠ¸ ê¸°ë°˜ ë°ì´í„° ë¬´ê²°ì„± ê²€ì¦]

**Before Start:**

- âš ï¸ ì£¼ì˜: `ON DELETE CASCADE`ê°€ ì„¤ì •ë˜ì–´ ìˆìœ¼ë¯€ë¡œ, ì˜ëª»ëœ í”„ë¡œì íŠ¸ ì‚­ì œ ìš”ì²­ ì‹œ ë³µêµ¬ê°€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤. íŒŒê´´ì ì¸ ì‘ì—… ì „ ì‚¬ìš©ì í™•ì¸ ë‹¨ê³„ë¥¼ ê±°ì³ì•¼ í•©ë‹ˆë‹¤.

**Implementation Items:**

- [x] **ID(P7-04)**: **ì¢…í•© í‰ê°€ API `projectId` í•„ìˆ˜ í•„í„°ë§ ê°•í™”** âœ… COMPLETED (2025-12-31 23:40)
  - `Target`: `frontend/src/app/api/rag/evaluate-holistic/route.ts` > `POST()`
  - `êµ¬í˜„ ë‚´ìš©`:
    - `const` â†’ `let` ë³€ê²½ìœ¼ë¡œ projectId ì¬í• ë‹¹ ê°€ëŠ¥í•˜ê²Œ ìˆ˜ì •
    - projectId ë¯¸ì œê³µ ì‹œ ì‚¬ìš©ìì˜ ì²« ë²ˆì§¸ í”„ë¡œì íŠ¸(ê°€ì¥ ì˜¤ë˜ëœ) ìë™ í• ë‹¹
    - projectId ì†Œìœ ê¶Œ ê²€ì¦: íƒ€ ì‚¬ìš©ì í”„ë¡œì íŠ¸ ì ‘ê·¼ ì‹œ 403 Forbidden ë°˜í™˜
    - `evaluation_logs` í…Œì´ë¸”ì— í‰ê°€ ê²°ê³¼ ì €ì¥ ë¡œì§ ì¶”ê°€
    - `project_id || null` ëª…ì‹œì  null ì²˜ë¦¬
    - ì €ì¥ ì‹¤íŒ¨ ì‹œì—ë„ í‰ê°€ ê²°ê³¼ëŠ” í´ë¼ì´ì–¸íŠ¸ì— ë°˜í™˜ (Graceful Degradation)
  - TypeScript ì»´íŒŒì¼: ì˜¤ë¥˜ 0ê°œ

---

## âœ… Definition of Done (ê²€ì¦)

### ê¸°ëŠ¥ ë° ì—ëŸ¬ ê²€ì¦

- [ ] **Test (Error 406/500)**: ëŒ€ì‹œë³´ë“œ ë° ê²€ìƒ‰ ê¸°ëŠ¥ ë°˜ë³µ ì‹¤í–‰ ì‹œ Supabase ë¡œê·¸ì— HTTP 400 ì´ìƒì˜ ì—ëŸ¬ ë°œìƒ ì—¬ë¶€ í™•ì¸
- [ ] **Test (Performance)**: ë¸Œë¼ìš°ì € ê°œë°œì ë„êµ¬(Network)ì—ì„œ `/api/chat` ì‘ë‹µì˜ TTFTê°€ **2000ms ì´í•˜**ì¸ì§€ 5íšŒ í…ŒìŠ¤íŠ¸ í‰ê· ê°’ ì¸¡ì •
- [ ] **Test (Isolation)**: í”„ë¡œì íŠ¸ Aì—ì„œ ì‹¤í–‰í•œ í‰ê°€ ê²°ê³¼ê°€ í”„ë¡œì íŠ¸ Bì˜ ëª©ë¡ì— ë…¸ì¶œë˜ì§€ ì•ŠëŠ”ì§€ êµì°¨ ê²€ì¦

### ì½”ë“œ í’ˆì§ˆ ë° ì˜ˆì™¸ ì²˜ë¦¬

- [ ] **Review**: ëª¨ë“  ë¹„ë™ê¸° í˜¸ì¶œ(`await`)ì— `try-catch` ë¸”ë¡ì´ ì ìš©ë˜ì–´ ìˆìœ¼ë©°, ì‚¬ìš©ìì—ê²ŒëŠ” ì¹œì ˆí•œ ì—ëŸ¬ ë©”ì‹œì§€ê°€ í‘œì‹œë˜ëŠ”ì§€ í™•ì¸
- [ ] **Review**: `console.log` ëŒ€ì‹  ì„œë¹„ìŠ¤ ë¡œê·¸ ì‹œìŠ¤í…œ(`logErrorToTelemetry`)ì„ ì‚¬ìš©í•˜ê³  ìˆëŠ”ì§€ í™•ì¸
- [ ] **Review**: ë¶ˆí•„ìš”í•œ ì¬ë Œë”ë§ì„ ë°©ì§€í•˜ê¸° ìœ„í•´ `useEffect` ë‚´ì˜ ì˜ì¡´ì„± ë°°ì—´ì´ ìµœì í™”ë˜ì—ˆëŠ”ì§€ í™•ì¸

---

## ğŸ“… ì˜ˆìƒ ì¼ì •

| ë‹¨ê³„     | ì‘ì—… ë‚´ìš©                    | ì†Œìš” ì‹œê°„  |
| -------- | ---------------------------- | ---------- |
| P7.1     | Critical ì—ëŸ¬ (406/500) í•´ê²° | 4ì‹œê°„      |
| P7.2     | ì±„íŒ… ì„±ëŠ¥ ìµœì í™” (TTFT)      | 4ì‹œê°„      |
| P7.3     | ë°ì´í„° ì •í•©ì„± ê°•í™” ë° ê²€ì¦   | 2ì‹œê°„      |
| **ì´ê³„** |                              | **10ì‹œê°„** |

---

> **ìµœì¢… ìŠ¹ì¸**: Tech Lead  
> **ë‹´ë‹¹ ê°œë°œì**: ì‹œë‹ˆì–´/ì£¼ë‹ˆì–´ í˜‘ì—…
