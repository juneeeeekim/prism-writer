# 2512242313_PDF_Text_Extraction_Enhancement_Checklist

## 📁 파일 구성 결정

**선택: 단일 파일 구성**

**근거:**

1. 모든 Phase가 `documentProcessor.ts` 단일 파일에 집중됨
2. 순차적 디버깅 → 수정 → 검증 흐름으로 연결됨
3. 협업 시 단일 문서로 진행 상황 추적이 용이함
4. Phase 간 의존성이 높아 분리 시 컨텍스트 손실 위험

---

## 📋 문서 개요

- **일자**: 2024-12-24
- **목적**: PDF 텍스트 추출 기능 개선 (한글 PDF 지원)
- **근본 문제**: pdf2json이 한글 PDF에서 텍스트를 추출하지 못함
- **참여자**:
  - 👨‍💻 **시니어 개발자**: 라이브러리 교체 및 아키텍처
  - 👶 **주니어 개발자**: 에러 핸들링 및 테스트
  - 🎨 **UX/UI 디자이너**: 에러 메시지 개선

---

## 🎯 목표

1. 한글이 포함된 일반 PDF에서 텍스트 추출 성공
2. 스캔된 이미지 PDF는 명확한 안내 메시지 제공
3. 디버깅 로그로 추출 결과 확인 가능

---

# Phase 1: 디버깅 - pdf2json 추출 결과 분석

## 영향받을 수 있는 기존 기능

- 문서 처리 파이프라인 (청킹, 임베딩)
- 에러 표시 UI
- 기존 TXT/MD 파일 처리

## 담당자

- 👨‍💻 시니어 개발자: 디버깅 로그 추가
- 👶 주니어 개발자: 테스트 및 로그 확인

## 체크리스트

### 1-1. pdf2json 추출 결과 상세 로깅 추가

- **파일**: `frontend/src/lib/rag/documentProcessor.ts`
- **위치**: `parsePDF()` 함수 내 `pdfParser_dataReady` 이벤트 핸들러

- [ ] `getRawTextContent()` 결과를 로그로 출력
- [ ] 추출된 텍스트 길이, 처음 100자, 마지막 100자 로깅
- [ ] trim() 전후의 길이 비교 로깅
- [ ] 에러 발생 시 pdfData 구조 전체 로깅

**품질 체크:**

- [ ] console.error 대신 console.log 사용 (디버깅용)
- [ ] 로그 메시지에 명확한 prefix 포함 (`[PDF DEBUG]`)
- [ ] 민감한 전체 내용은 로깅하지 않음 (처음/마지막 100자만)

### 1-2. Vercel 배포 및 테스트

- [ ] 변경 사항 커밋 및 푸시
- [ ] Vercel 배포 완료 확인
- [ ] 동일 PDF 파일 재업로드
- [ ] Vercel Functions 로그에서 디버깅 정보 확인

## Phase 1 검증 체크리스트

- [ ] Syntax 오류 확인 (`npx tsc --noEmit`)
- [ ] 빌드 성공 확인 (`npm run build`)
- [ ] Vercel 로그에서 `[PDF DEBUG]` 메시지 확인
- [ ] 기존 TXT/MD 파일 업로드 정상 작동 확인

---

# Phase 2: 라이브러리 교체 결정

## 영향받을 수 있는 기존 기능

- `parsePDF()` 함수 전체
- PDF 파일 업로드 처리

## 담당자

- 👨‍💻 시니어 개발자: 라이브러리 비교 및 선택
- 👶 주니어 개발자: 테스트 케이스 작성

## 체크리스트

### 2-1. Phase 1 디버깅 결과 분석

- [ ] pdf2json이 추출한 텍스트 내용 확인
- [ ] 빈 문자열인지, 깨진 문자인지, 특수 인코딩인지 파악
- [ ] 문제 원인 문서화

### 2-2. 대안 라이브러리 선택

| 라이브러리             | 한글 지원 | Vercel 호환       | 의존성 | 선택 |
| ---------------------- | --------- | ----------------- | ------ | ---- |
| pdf-parse (재시도)     | ⚠️        | ❌ DOMMatrix 문제 | 있음   | -    |
| pdfjs-dist (직접 사용) | ✅        | ⚠️ 설정 필요      | 있음   | -    |
| pdf2json (현재)        | ❌        | ✅                | 없음   | 현재 |
| 외부 API (OCR)         | ✅        | ✅                | 없음   | 대안 |

- [ ] Phase 1 결과에 따라 최적 라이브러리 선택
- [ ] 선택 근거 문서화

## Phase 2 검증 체크리스트

- [ ] 디버깅 결과 분석 완료
- [ ] 라이브러리 선택 결정 및 근거 문서화
- [ ] 팀 합의 확인

---

# Phase 3: 라이브러리 교체 또는 설정 변경

## 영향받을 수 있는 기존 기능

- `parsePDF()` 함수
- `parseDocumentContent()` 함수
- package.json 의존성

## 담당자

- 👨‍💻 시니어 개발자: 코드 수정
- 👶 주니어 개발자: 테스트 실행

## 체크리스트

### 3-1. 선택된 라이브러리 구현

**(옵션 A: pdf2json 설정 조정 - 인코딩 처리)**

- [ ] `frontend/src/lib/rag/documentProcessor.ts` 수정
- [ ] pdf2json 옵션에서 인코딩 설정 조정
- [ ] decodeURIComponent 적용 여부 테스트

**(옵션 B: pdfjs-dist 직접 사용)**

- [ ] `npm install pdfjs-dist` 설치
- [ ] parsePDF 함수 pdfjs-dist 버전으로 재작성
- [ ] Vercel 호환성 위한 worker 설정

**(옵션 C: 외부 OCR API 연동)**

- [ ] Google Cloud Vision 또는 AWS Textract API 키 설정
- [ ] OCR 호출 함수 작성
- [ ] 비용 관리 로직 추가

### 3-2. 에러 핸들링 개선

- **파일**: `frontend/src/lib/rag/documentProcessor.ts`
- **위치**: `parsePDF()` catch 블록

- [ ] 인코딩 오류 감지 및 처리
- [ ] 한글 깨짐 감지 로직 추가

**품질 체크:**

- [ ] 코딩 스타일 일치 (기존 패턴 따르기)
- [ ] 명확한 에러 메시지
- [ ] try-catch 블록 적절히 사용

## Phase 3 검증 체크리스트

- [ ] Syntax 오류 확인 (`npx tsc --noEmit`)
- [ ] 빌드 성공 확인 (`npm run build`)
- [ ] 한글 PDF 업로드 → 텍스트 추출 성공
- [ ] 영문 PDF 업로드 → 텍스트 추출 성공
- [ ] TXT/MD 파일 업로드 → 기존 기능 정상 작동

---

# Phase 4: 에러 메시지 UX 개선

## 영향받을 수 있는 기존 기능

- 사용자에게 표시되는 에러 메시지
- 문서 상태 표시 UI

## 담당자

- 🎨 UX/UI 디자이너: 메시지 개선
- 👶 주니어 개발자: 코드 적용

## 체크리스트

### 4-1. 에러 메시지 개선

- **파일**: `frontend/src/lib/rag/documentProcessor.ts`
- **위치**: `processDocument()` catch 블록의 userErrorMessage 매핑

| 현재 메시지                            | 개선 메시지                                                                    |
| -------------------------------------- | ------------------------------------------------------------------------------ |
| 스캔된 이미지 PDF는 지원되지 않습니다. | PDF에서 텍스트를 추출할 수 없습니다. 텍스트가 포함된 PDF 파일을 사용해 주세요. |
| 문서 처리 중 오류가 발생했습니다.      | 문서를 처리할 수 없습니다. 다른 형식의 파일을 시도해 주세요.                   |

- [ ] 에러 메시지 매핑 수정
- [ ] 한국어 표현 자연스럽게 수정

### 4-2. 프론트엔드 에러 표시 확인

- **파일**: `frontend/src/components/documents/DocumentItem.tsx` (또는 관련 컴포넌트)

- [ ] 에러 메시지가 UI에 올바르게 표시되는지 확인
- [ ] 에러 상태 스타일링 (빨간색 등)

**품질 체크:**

- [ ] 접근성 고려 (aria-label, role="alert")
- [ ] 에러 메시지 길이 적절함 (너무 길지 않음)

## Phase 4 검증 체크리스트

- [ ] Syntax 오류 확인
- [ ] 빌드 성공 확인
- [ ] 에러 발생 시 개선된 메시지 표시 확인
- [ ] 스크린리더로 에러 메시지 읽힘 확인 (옵션)

---

# Phase 5: 최종 통합 검증

## 영향받을 수 있는 기존 기능

- 전체 문서 업로드/처리 파이프라인
- RAG 검색 기능

## 담당자

- 👨‍💻 시니어 개발자: 전체 검증
- 👶 주니어 개발자: 테스트 케이스 실행
- 🎨 UX/UI 디자이너: 사용자 경험 검증

## 체크리스트

### 5-1. 테스트 케이스 실행

| 테스트 케이스                 | 예상 결과                          | 담당 |
| ----------------------------- | ---------------------------------- | ---- |
| 한글 텍스트 PDF 업로드        | ✅ 텍스트 추출 성공, 상태 "준비됨" | 👶   |
| 영문 텍스트 PDF 업로드        | ✅ 텍스트 추출 성공, 상태 "준비됨" | 👶   |
| 스캔 이미지 PDF 업로드        | ❌ 개선된 에러 메시지 표시         | 🎨   |
| TXT 파일 업로드               | ✅ 텍스트 추출 성공, 상태 "준비됨" | 👶   |
| MD 파일 업로드                | ✅ 텍스트 추출 성공, 상태 "준비됨" | 👶   |
| "준비됨" 상태 문서로 RAG 검색 | ✅ 검색 결과 반환                  | 👨‍💻   |

- [ ] 모든 테스트 케이스 통과
- [ ] 실패한 케이스 원인 분석 및 수정

### 5-2. 디버깅 로그 정리

- **파일**: `frontend/src/lib/rag/documentProcessor.ts`

- [ ] Phase 1에서 추가한 `[PDF DEBUG]` 로그를 조건부로 변경 (개발 환경에서만 출력)
- [ ] 불필요한 console.log 제거

### 5-3. 문서화

- [ ] 체크리스트 파일 완료 상태로 업데이트
- [ ] 변경 사항 요약 작성

## Phase 5 검증 체크리스트

- [ ] 전체 테스트 케이스 통과
- [ ] Vercel Production 배포 완료
- [ ] 디버깅 로그 정리 완료
- [ ] 기존 모든 기능 정상 작동 확인

---

# 📝 변경 이력

| 날짜       | Phase | 작업 내용       | 담당자  |
| ---------- | ----- | --------------- | ------- |
| 2024-12-24 | -     | 체크리스트 작성 | 팀 전체 |

---

# 🛑 롤백 전략

문제 발생 시:

1. `git revert <commit-hash>` 로 이전 상태로 복원
2. PDF 업로드 기능 임시 비활성화 (프론트엔드)
3. TXT/MD 파일만 지원하도록 UI 안내 추가
