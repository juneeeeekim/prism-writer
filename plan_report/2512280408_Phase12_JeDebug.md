# Phase 12: JeDebug 검증 리포트

**검토 대상**: `2512280405_Phase12_Category_Accordion_Checklist.md`  
**검토일**: 2025-12-28 04:08

---

## 1) 🔧 로직 및 구현 보완 (Logic Fixes)

### Critical Issues

- [ ] **(Critical) P2-01: Request Body에서 category 추출 누락**

  - [ ] 원인: Save API에서 `category`를 INSERT/UPDATE에 사용하지만, request body에서 추출하는 코드가 없음
  - [ ] **수정 제안**: P2-01 Detail 상단에 다음 코드 추가
    ```typescript
    // request body parsing 부분에 category 추가
    const { id, title, content, category } = await request.json();
    ```
  - [ ] 파일/위치: `frontend/src/app/api/documents/save/route.ts` (Line ~25)

- [ ] **(Critical) P3-02/P3-04: 에디터에서 카테고리 목록 가져오는 로직 누락**

  - [ ] 원인: 에디터 페이지에서 `existingCategories`를 사용하지만, `useDocuments`의 `fetchList`를 호출하지 않으면 빈 배열
  - [ ] **수정 제안**: P3-02에 다음 항목 추가

    ```tsx
    // 에디터 마운트 시 카테고리 목록 로드
    const { categories, fetchList } = useDocuments();

    useEffect(() => {
      fetchList(); // 카테고리 목록 가져오기
    }, []);
    ```

  - [ ] 파일/위치: `frontend/src/app/editor/page.tsx`

- [ ] **(Critical) P4-03: CategoryAccordion import 누락**
  - [ ] 원인: documents/page.tsx에서 CategoryAccordion 사용하지만 import 문 명시 안됨
  - [ ] **수정 제안**: P4-03 Detail 상단에 import 추가
    ```tsx
    import CategoryAccordion from "@/components/documents/CategoryAccordion";
    ```
  - [ ] 파일/위치: `frontend/src/app/documents/page.tsx` (상단 import)

---

### Major Issues

- [ ] **(Major) P3-01: useEditorState 타입 정의 누락**

  - [ ] 원인: Zustand store의 State 인터페이스에 category 타입 추가가 명시되지 않음
  - [ ] **수정 제안**: P3-01 Detail에 State 인터페이스 수정 추가
    ```typescript
    interface EditorState {
      // ... 기존 필드
      category: string; // 추가
      setCategory: (category: string) => void; // 추가
    }
    ```
  - [ ] 파일/위치: `frontend/src/hooks/useEditorState.ts`

- [ ] **(Major) P3-01: setCategory 액션 구현 누락**

  - [ ] 원인: category 상태는 있지만 setCategory 함수 구현이 없음
  - [ ] **수정 제안**: P3-01 Detail에 setCategory 구현 추가
    ```typescript
    setCategory: (category) => set({ category, isDirty: true });
    ```
  - [ ] 파일/위치: `frontend/src/hooks/useEditorState.ts`

- [ ] **(Major) P4-04: DocumentCard Props 타입 불일치**
  - [ ] 원인: DocumentCard에 category를 전달하지만 현재 Props에 category가 없을 수 있음
  - [ ] **수정 제안**: P4-04 Before에 DocumentCard Props 확인 및 수정 추가
    ```tsx
    // DocumentCard props에 category 추가
    interface DocumentCardProps extends UserDocumentPreview {
      // category는 UserDocumentPreview에 이미 포함 (P1-03에서)
    }
    ```
  - [ ] 파일/위치: `frontend/src/components/documents/DocumentCard.tsx`

---

## 2) 🚨 리스크 및 안전장치 (Risk Guardrails)

### High Priority

- [ ] **(High) 기존 Phase 11 문서 category null 처리**

  - [ ] 위험 요소: DB 마이그레이션 전에 저장된 문서는 category가 null일 수 있음
  - [ ] **방어 코드 추가 제안**: P2-02, P4-02에 null 체크 추가

    ```typescript
    // List API 응답 매핑
    category: doc.category ?? "미분류"; // null 안전 처리

    // 그룹핑 함수
    const cat = doc.category ?? "미분류";
    ```

  - [ ] 파일/위치: `list/route.ts`, `documents/page.tsx`

- [ ] **(High) Save API 응답에 category 포함 누락**
  - [ ] 위험 요소: 저장 후 응답에 category가 없으면 프론트 상태 불일치
  - [ ] **방어 코드 추가 제안**: P2-01에 select 추가
    ```typescript
    .select('id, title, category, updated_at')
    ```
  - [ ] 파일/위치: `frontend/src/app/api/documents/save/route.ts`

---

### Medium Priority

- [ ] **(Mid) 카테고리 빈 문자열 vs null 처리**

  - [ ] 위험 요소: 사용자가 카테고리를 공백으로 저장하면 '' vs '미분류' 불일치
  - [ ] **방어 로직 제안**: P2-01, P3-03에 trim 및 fallback 추가
    ```typescript
    category: category?.trim() || "미분류";
    ```
  - [ ] 파일/위치: Save API, handleSave

- [ ] **(Mid) 대소문자 카테고리 중복**
  - [ ] 위험 요소: "마케팅"과 "마케Ting"이 다른 카테고리로 취급될 수 있음
  - [ ] **방어 로직 제안**: [선택사항] 향후 카테고리 정규화 고려
  - [ ] 파일/위치: 별도 Phase에서 처리

---

## 3) 🧪 검증 기준 구체화 (Test Criteria)

### Happy Path 테스트

- [ ] 새 문서 + 카테고리 "마케팅" 저장 → DB에 category='마케팅' 저장됨
- [ ] 기존 문서 편집 → 카테고리 변경 → 저장 → DB 반영 확인
- [ ] 목록 페이지 → 카테고리별 그룹 표시
- [ ] 카테고리 헤더 클릭 → 접기/펼치기 동작
- [ ] 드롭다운에서 기존 카테고리 선택 → 정확히 입력됨
- [ ] 새 카테고리 직접 입력 → 저장 후 다음 저장에서 드롭다운에 표시

### Edge Case 테스트

- [ ] 카테고리 미입력 저장 → '미분류'로 저장
- [ ] 카테고리에 공백만 입력 → '미분류'로 저장
- [ ] 특수문자 포함 카테고리 → 정상 저장 및 표시
- [ ] 기존 Phase 11 문서(category null) → 목록에서 '미분류' 그룹에 표시
- [ ] 문서 삭제 후 → 해당 카테고리 그룹에서 사라짐
- [ ] 카테고리 내 모든 문서 삭제 → 빈 카테고리 헤더 표시 안됨 (또는 빈 상태 표시)

---

## 4) 최종 판단 (Decision)

- [x] 상태 선택: **⚠️ 체크리스트 수정 후 진행**
- [x] 가장 치명적인 결함: **P2-01에서 request body의 category 추출 코드 누락 → API가 category를 저장하지 못함**

---

## 📋 수정 필요 체크리스트 요약

| ID           | 심각도   | 위치               | 수정 내용                                 |
| ------------ | -------- | ------------------ | ----------------------------------------- |
| P2-01        | Critical | save/route.ts      | request body에서 category 추출 추가       |
| P2-01        | High     | save/route.ts      | 응답 select에 category 추가               |
| P3-02        | Critical | editor/page.tsx    | fetchList 호출로 카테고리 목록 로드       |
| P3-01        | Major    | useEditorState.ts  | State 인터페이스 및 setCategory 구현 추가 |
| P4-03        | Critical | documents/page.tsx | CategoryAccordion import 추가             |
| P2-02, P4-02 | High     | 다수               | null → '미분류' 안전 처리                 |

---

## ✅ 수정 반영 후 진행 가능

위 6개 항목을 체크리스트에 반영한 후 구현을 진행하십시오.
