# 🔍 PRISM Writer RAG 시스템 아키텍처 분석 보고서

**작성일**: 2025-12-28  
**작성자**: Tech Lead & Junior Developer & UX Expert  
**디렉터님 답변 반영**: 2025-12-28 23:27

---

## 📋 디렉터님 요구사항 정리

### 1️⃣ 카테고리 격리

> **디렉터님 답변**:
>
> - 카테고리는 **무궁무진**하며, 작성하려는 글들의 **묶음의 주제**가 카테고리가 됨
> - 1개의 카테고리가 **재활용될 가능성은 없음**
> - **현재 글의 카테고리의 참고자료만** 사용해야 함

**결론**: ✅ 카테고리별 완전 격리 필요 (동일 카테고리의 참고자료만 평가에 사용)

---

### 2️⃣ RAFT 합성 데이터 활용

> **디렉터님 답변**:
>
> 1. **즉시 활용**: 카테고리 내에서 LLM 모델 답변을 **맞춤형**으로 만드는 것
> 2. **미래 활용**: 카테고리별 RAFT 합성 데이터가 많이 쌓이면, **사용자 맞춤 알고리즘** 등에 활용
> 3. **현재 단계**: 아이디어 구상 중 → **데이터 축적 및 관리**가 우선

**결론**:

- ✅ 현재: 데이터 축적/관리 체계 강화
- 🔮 미래: 팀 아이디어 수집 필요

---

### 3️⃣ 전체 글 종합 평가 형태

> **디렉터님 답변**: A + B + C **전체 다 필요**

| 형태  | 설명                         | 필요 여부 |
| ----- | ---------------------------- | --------- |
| **A** | 한 문단의 종합 피드백 텍스트 | ✅ 필요   |
| **B** | 구조/내용/표현별 줄글 조언   | ✅ 필요   |
| **C** | 점수 + 상세 조언             | ✅ 필요   |

**결론**: ✅ 포괄적인 종합 평가 시스템 구축 필요

---

## 🎯 구현 목표 (To-Be)

### 최종 평가 결과물 예시

```
┌─────────────────────────────────────────────────────────────┐
│  📊 종합 평가 결과                                          │
├─────────────────────────────────────────────────────────────┤
│  [A] 종합 피드백 (한 문단)                                   │
│  ───────────────────────────────                             │
│  귀하의 글은 HSP의 특징을 명확하게 설명하고 있습니다.        │
│  다만 도입부와 본문의 연결이 약하며, 결론에서 핵심 메시지가  │
│  명확하지 않습니다. 전체 구조를 "문제-원인-해결책" 형태로    │
│  재구성하면 독자 이해도가 높아질 것입니다.                   │
├─────────────────────────────────────────────────────────────┤
│  [B] 영역별 조언                                             │
│  ───────────────────────────────                             │
│  📐 구조: 도입부가 너무 길어 핵심 전달이 늦어집니다.         │
│  📝 내용: 사례가 풍부하나, 순서 정리가 필요합니다.           │
│  ✨ 표현: 전문 용어 사용이 적절하나, 일부 문장이 깁니다.     │
├─────────────────────────────────────────────────────────────┤
│  [C] 점수 & 상세 조언                                        │
│  ───────────────────────────────                             │
│  📊 종합 점수: 72/100                                        │
│  ┌───────────────────────────┐                               │
│  │ 구조  ████████░░  80점    │                               │
│  │ 내용  ███████░░░  70점    │                               │
│  │ 표현  ██████░░░░  60점    │                               │
│  │ 논리  ████████░░  80점    │                               │
│  └───────────────────────────┘                               │
│                                                              │
│  상세 조언:                                                  │
│  1. 도입부 3문장을 1문장으로 압축하세요                      │
│  2. 결론에 "따라서"로 시작하는 핵심 문장 추가하세요          │
│  3. "~것이다" 어미를 "~합니다"로 통일하세요                  │
└─────────────────────────────────────────────────────────────┘
```

---

## 📊 현재 시스템 vs 구현 필요 사항

### 현재 구현 상태

| 기능                       | 상태    | 비고                      |
| -------------------------- | ------- | ------------------------- |
| 카테고리별 참고자료 저장   | ✅ 완료 | `user_documents.category` |
| 카테고리별 청크 검색       | ✅ 완료 | `search.ts` Phase 14.5    |
| RAFT 합성 데이터 생성      | ✅ 완료 | `/admin/raft`             |
| 기준별 평가 (현재 평가 탭) | ✅ 완료 | `EvaluationTab.tsx`       |

### 구현 필요 사항

| 기능                           | 상태           | 우선순위    |
| ------------------------------ | -------------- | ----------- |
| **평가 시 카테고리 격리**      | ❌ 미구현      | 🔴 Critical |
| **종합 피드백 A (한 문단)**    | ❌ 미구현      | 🔴 Critical |
| **영역별 조언 B**              | ❌ 미구현      | 🔴 Critical |
| **점수 + 상세 조언 C**         | ⚠️ 부분 구현   | 🟡 Major    |
| **RAFT 데이터 축적 관리 강화** | ⚠️ 기본만 구현 | 🟡 Major    |

---

## 🛠️ 구현 계획

### Phase 1: 카테고리 격리 (Critical)

**목표**: 평가 시 현재 글의 카테고리와 동일한 참고자료만 사용

**수정 파일**:

```
- /api/rag/evaluate/route.ts
  → vectorSearch() 호출 시 category 파라미터 추가

- EvaluationTab.tsx
  → 현재 문서의 category를 평가 API에 전달
```

**예상 작업량**: 2-3시간

---

### Phase 2: 전체 글 종합 평가 시스템 (Critical)

**목표**: A + B + C 전체 형태의 종합 평가 제공

**새로운 구성 요소**:

```
1. /api/rag/evaluate-holistic/route.ts (NEW)
   - 전체 글 + 해당 카테고리 참고자료 입력
   - LLM 호출로 종합 피드백 생성

2. HolisticFeedbackPanel.tsx (NEW)
   - 종합 피드백 표시 UI
   - A + B + C 모두 표시

3. 평가 탭 UI 업그레이드
   - 기존: 기준별 평가만
   - 신규: 종합 평가 + 기준별 평가
```

**예상 작업량**: 1-2일

---

### Phase 3: RAFT 데이터 관리 강화 (Major)

**목표**: 미래 활용을 위한 데이터 축적/관리 체계 강화

**구현 사항**:

```
1. RAFT 데이터 통계 대시보드
   - 카테고리별 Q&A 개수
   - 생성 일자별 추이

2. 데이터 품질 관리
   - 생성된 Q&A 검토/삭제 기능
   - 평점/태그 기능 (미래 활용 대비)

3. 내보내기 기능
   - JSON/CSV 형태로 데이터 추출
   - Fine-tuning 데이터셋 형식 지원
```

**예상 작업량**: 2-3일

---

## 💡 팀 아이디어 수집: RAFT 데이터 미래 활용

디렉터님 요청에 따라 RAFT 합성 데이터 미래 활용에 대한 아이디어를 수집합니다.

### 아이디어 제안 양식

| 항목            | 내용           |
| --------------- | -------------- |
| **제안자**      | (이름/역할)    |
| **활용 방식**   | (어떻게 활용?) |
| **기대 효과**   | (어떤 가치?)   |
| **구현 복잡도** | (상/중/하)     |

---

### 초기 아이디어 (Tech Lead)

| ID       | 아이디어                      | 설명                                                    |
| -------- | ----------------------------- | ------------------------------------------------------- |
| **R-01** | 카테고리별 글쓰기 스타일 분석 | RAFT Q&A에서 패턴 추출 → 카테고리별 "좋은 글" 특성 정의 |
| **R-02** | 자동 템플릿 생성              | 많이 쌓인 데이터에서 글쓰기 템플릿 자동 생성            |
| **R-03** | 개인화 추천 알고리즘          | 사용자별 글쓰기 패턴 분석 → 맞춤형 조언                 |
| **R-04** | Fine-tuning 데이터셋          | 특정 도메인 LLM 학습용 데이터 생성                      |

---

## ✅ 다음 단계

1. **디렉터님 승인** → 구현 계획 확정
2. **Phase 1 (카테고리 격리)** 즉시 착수
3. **Phase 2 (종합 평가)** 설계 및 구현
4. **Phase 3 (RAFT 관리)** 팀 논의 후 진행
5. **RAFT 미래 활용 아이디어** 팀 수집

---

**End of Analysis Report (Updated)**
